# è¯­éŸ³æ’­æŠ¥ â™¥
<font color="#ffff00">è¯»å–æœ¬åœ°yoloæ§åˆ¶æ¿ è¯­éŸ³æ’­æŠ¥ï¼Œç°åœ¨ç¡¬ä»¶å·²ç»èƒ½æŒ‰é”®è§¦å‘è¯†åˆ« ç„¶åæ¥æ”¶åˆ°è¯†åˆ«çš„ç»“æœ</font>
<font color="#ffff00">ä¸‹ä¸€æ­¥å°±æ˜¯å°†å¯¹åº”çš„è¯†åˆ«ä¿¡æ¯è¿›è¡Œæ’­æŠ¥äº†</font>

ä¸Šä¼ æ–‡ä»¶æ’­æ”¾ æŒ‰ä¸‹æŒ‰é’®åˆ™æ’­æ”¾ï¼š
[ESP8266æ’­æ”¾éŸ³é¢‘æ–‡ä»¶ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/37907663)

[å›¾å§å°ç™½æ•™ç¨‹ ç¯‡å››åï¼šç”¨ESP8266 WIFIæ¨¡å—è‡ªåˆ¶MP3_éŸ³é¢‘æ’­æ”¾å™¨_ä»€ä¹ˆå€¼å¾—ä¹° (smzdm.com)](https://post.smzdm.com/p/awxq4d5g/)

ğŸ˜github : [earlephilhower/ESP8266Audioï¼šArduino åº“ï¼Œå¯åœ¨ I3S DAC ä¸Šæ’­æ”¾ MODã€WAVã€FLACã€MIDIã€RTTTLã€MP2 å’Œ AAC æ–‡ä»¶ï¼Œæˆ–åœ¨ ESP8266 å’Œ ESP32 ä¸Šä½¿ç”¨è½¯ä»¶æ¨¡æ‹Ÿ Î”-Î£ DAC æ–‡ä»¶ (github.com)](https://github.com/earlephilhower/ESP8266Audio)

ä»˜è´¹ï¼š[åˆ©ç”¨ESP8266Audioåº“å®ç°ESP8266è¯­éŸ³æ’­æŠ¥åŠŸèƒ½_ç‰©è”å­¦é•¿çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/m0_66347114/article/details/125793124)

---
# æ–¹æ¡ˆ1 SAM
Sam is a very small Text-To-Speech (TTS) program written in C

å®˜ç½‘ï¼šhttps://simulationcorner.net/index.php?page=sam
[Website of Jan Derogee](https://janderogee.com/projects/SerialSpeechSynthesisSAM/SerialSpeechSynthesisSAM.htm)

æœç´¢å…³é”®è¯ï¼šESP8266SAM ã€è¿˜æ˜¯ä¾èµ–çš„åº“åç§°ã€‘

ğŸ˜ä»˜è´¹ è¿™ä¸ªçœ‹èµ·æ¥ç›®å‰æœ€é è°±çš„ï¼š
[ESP8266SAM:ä½¿ç”¨SAMç«¯å£çš„ESP8266è¯­éŸ³åˆæˆ_esp32è°ƒç”¨tts-å…¶å®ƒä»£ç ç±»èµ„æº-CSDNæ–‡åº“](https://download.csdn.net/download/weixin_42108778/18315617?spm=1001.2101.3001.6650.13&utm_medium=distribute.pc_relevant.none-task-download-2%7Edefault%7EOPENSEARCH%7ERate-13-18315617-blog-125793124.235%5Ev29%5Epc_relevant_default_base3&depth_1-utm_source=distribute.pc_relevant.none-task-download-2%7Edefault%7EOPENSEARCH%7ERate-13-18315617-blog-125793124.235%5Ev29%5Epc_relevant_default_base3&utm_relevant_index=19)
![](201903040009images.aasts/image-20230417182421201.png)
è¿™ä¸ªæ˜¯æ¬è¿çš„ï¼š[earlephilhower/ESP8266SAM: Speech synthesis for ESP8266 using S.A.M. port (github.com)](https://github.com/earlephilhower/ESP8266SAM)


ğŸ˜githubç¬¬ä¸€æ®µæœ‰æåˆ°ï¼š[earlephilhower/ESP8266Audio: Arduino library to play MOD, WAV, FLAC, MIDI, RTTTL, MP3, and AAC files on I2S DACs or with a software emulated delta-sigma DAC on the ESP8266 and ESP32 (github.com)](https://github.com/earlephilhower/ESP8266Audio#installation)
![](201903040009images.aasts/image-20230417182723469.png)

# æ–¹æ¡ˆ2 TTSè¯­éŸ³åˆæˆæ¨¡å— SYN6288ğŸ˜ 
---
updated: 2023-04-17 21:44 #å¾…åŠ 

æ·˜å®é“¾æ¥ èµ„æ–™ï¼š
[SYN6288è¯­éŸ³åˆæˆæ¨¡å— æ–‡å­—è½¬è¯­éŸ³TTSçœŸäººå‘éŸ³ æœ‰ä¸Šä½æœº å–‡å­-tmall.comå¤©çŒ«](https://detail.tmall.com/item.htm?app=chrome&bxsign=scdBaNJ6P0-YdRyljFS7qv8EJupuyec0OoKmY1T-ULnOszPTlANVxcFGpWh6eDETU-eOmBWLNamfNqQ9wzo3pz2D7mi4i9EU08iJH1m3GMYH4Dp-A_c3nZRPFnGsqbqYM7j&cpp=1&id=626679473209&price=47.6-48.6&shareUniqueId=20986849964&share_crt_v=1&shareurl=true&short_name=h.UtjXdNO&sourceType=item,item&sp_abtk=gray_1_code_simpleAndroid2&sp_tk=QWxzbmRsTUdRR2c=&spm=a2159r.13376460.0.0&suid=3803e159-fe0d-4def-b3e1-6c5d2f073eb9&tbSocialPopKey=shareItem&tk=AlsndlMGQGg&un=56d835173df514b90f8768acc41474bb&un_site=0&ut_sk=1.YaV48WG3xLkDACjC6cdD9B0Y_21646297_1681732044873.Copy.1)

[Arduino è¯­éŸ³äº¤äº’ TTSè¯­éŸ³åˆæˆï¼ˆä¸€ï¼‰ (zhihu.com)](https://www.zhihu.com/tardis/zm/art/66314323?source_id=1005#:~:text=Arduino%20%E8%AF%AD%E9%9F%B3%E4%BA%A4%E4%BA%92%20TTS%E8%AF%AD%E9%9F%B3%E5%90%88%E6%88%90%EF%BC%88%E4%B8%80%EF%BC%89%201%201.%E4%BB%80%E4%B9%88%E6%98%AFTTS%20TTS%E6%98%AFText%20To%20Speech%E7%9A%84%E7%BC%A9%E5%86%99%EF%BC%8C%E5%8D%B3%E2%80%9C%E4%BB%8E%E6%96%87%E6%9C%AC%E5%88%B0%E8%AF%AD%E9%9F%B3%E2%80%9D%EF%BC%8C%E6%98%AF%E4%BA%BA%E6%9C%BA%E5%AF%B9%E8%AF%9D%E7%9A%84%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%8C%E8%AE%A9%E6%9C%BA%E5%99%A8%E8%83%BD%E5%A4%9F%E8%AF%B4%E8%AF%9D%E3%80%82,...%204%204.%E7%A8%8B%E5%BA%8F%20%E7%A8%8B%E5%BA%8F%E6%98%AF%EF%BC%8C%E9%80%9A%E8%BF%87%E4%B8%B2%E5%8F%A3%EF%BC%8C%E5%B0%86%E6%8C%87%E4%BB%A4%E5%8F%8A%E8%AF%AD%E9%9F%B3%E6%95%B0%E6%8D%AE%E5%8F%91%E9%80%81%E7%BB%99TTS%E8%AF%AD%E8%A8%80%E5%90%88%E6%88%90%E6%A8%A1%E5%9D%97%E3%80%82%20%E5%86%8D%E9%80%9A%E8%BF%87%E8%80%B3%E6%9C%BA%E5%B0%86%E5%90%88%E6%88%90%E5%A5%BD%E7%9A%84%E5%A3%B0%E9%9F%B3%E6%92%AD%E6%94%BE%E5%87%BA%E6%9D%A5%E3%80%82%20...%205%205.%E6%95%88%E6%9E%9C%E5%B1%95%E7%A4%BA)
[arduinoè°ƒç”¨æ–‡æœ¬è½¬è¯­éŸ³çš„æ¥å£ - æœç´¢ (bing.com)](https://www.bing.com/search?q=arduino%E8%B0%83%E7%94%A8%E6%96%87%E6%9C%AC%E8%BD%AC%E8%AF%AD%E9%9F%B3%E7%9A%84%E6%8E%A5%E5%8F%A3&qs=n&form=QBRE&sp=-1&lq=0&pq=arduinodiao%27yo%E6%96%87%E6%9C%AC%E8%BD%AC%E8%AF%AD%E9%9F%B3%E7%9A%84%E6%8E%A5%E5%8F%A3&sc=0-22&sk=&cvid=471A33983B9546B48D1AA87801ECD8D2&ghsh=0&ghacc=0&ghpl=)

---
æˆ‘ä»¬ä¸è¿™ä¸ªèŠ¯ç‰‡â€œå¯¹è¯â€ç”¨çš„ä¸æ˜¯ä¸­æ–‡ï¼Œå¾—é¦–å…ˆæŠŠä¸­æ–‡è½¬æ¢å®ƒæ‰èƒ½â€œå¿µå‡ºæ¥â€ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šè¿™äº›è½¬æ¢çš„æ–¹æ³•ã€‚

ï¼Ÿ èƒ½ä¸èƒ½åœ¨å†…éƒ¨ç°è½¬æ¢
æˆ–è€…åŒ¹é…ä¹‹åæŒ¨ä¸ªå¿µ å®šä¹‰ä¸€å †å·²ç»å­˜å¥½çš„å›ºå®šå­— ç»„åˆå°±è¡Œè¿™æ ·å­

## å®ç°æ„æ€
å¦‚æœæ˜¯é€ä¸ªåŒ¹é…æ¥è¯­éŸ³æ’­æŠ¥ï¼Œé‚£ä¹ˆæˆ‘å‘å¸ƒçš„è¯†åˆ«æ¶ˆæ¯æˆ‘æ”¹æˆåè¿›åˆ¶çš„å­—ç¬¦ä¸²å‘é€åˆ°ç¡¬ä»¶ï¼Œé»˜è®¤æ¯ä¸€ä¸ªç§ç±»çš„æ•°é‡å…è®¸0-9ã€‚
![](201903040009images.aasts/image-20230417213126727.png)
![](201903040009images.aasts/image-20230417214124846.png)


åœ¨ç¡¬ä»¶å¤„å®šä¹‰speech();å‡½æ•° ç­‰ç€åŒ¹é…
åœ¨ç¡¬ä»¶å¤„æ”¶åˆ°æ¶ˆæ¯åï¼Œå°†å­—ç¬¦ä¸²åˆ†éš”/<span style="background:#ff4d4f">æ‹†åˆ†</span>å¹¶ä»¥ç±»ä¼¼`message == "0000"`è¿™æ ·åˆ¤æ–­ç­–ç•¥å¯¹æ¯ä¸€ä¸ªè¿›è¡Œåˆ¤æ–­å’Œæ’­æŠ¥ï¼Œä¸­é—´ç©¿æ’åˆé€‚çš„è¿‡åº¦è¯­å¥æ’­æŠ¥ã€‚


[åœ¨ Arduino ä¸­æ‹†åˆ†å­—ç¬¦ä¸² | Dæ ˆ - Delft Stack](https://www.delftstack.com/zh/howto/arduino/arduino-split-string/)


```c
String My_S = "hello world";

void setup(){
    Serial.begin(9600);
}
void loop(){
    String sub_S = My_S.substring(0,5);
    Serial.println(sub_S);
    delay(1000);
}
# è¾“å‡ºï¼šhello
# å­—ç¬¦ä¸²æ‹†åˆ†å°†ä» 0 å¼€å§‹ï¼ŒåŒ…æ‹¬ 0 ç´¢å¼•å­—ç¬¦ï¼Œå¹¶åœ¨ç´¢å¼• 5 ç»“æŸï¼Œä¸åŒ…æ‹¬ç´¢å¼• 5 å¤„çš„å­—ç¬¦ã€‚
```

## ä»£ç ï¼šæ”¶åˆ°çš„messageæ‹†åˆ† ç»„åˆæ‰“å°


```c
String message = "33333563";

void setup(){
    Serial.begin(115200);
}
void loop(){
   mp3(message);
   delay(3000);


}


void mp3(String message1){
  // 0 1 2 4 7
    String sub_0 = message.substring(0,1);//äºº
    String sub_1 = message.substring(1,2);//è‡ªè¡Œè½¦
    String sub_2 = message.substring(2,3);//æ±½è½¦
    String sub_4 = message.substring(4,5);//å…¬äº¤è½¦
    String sub_7 = message.substring(7,8);//ç‹—
    int sub_0_int =(sub_0).toInt();
    int sub_1_int =(sub_1).toInt();
    int sub_2_int =(sub_2).toInt();
    int sub_4_int =(sub_4).toInt();
    int sub_7_int =(sub_7).toInt();
   

   if(message == "00000000"){
    Serial.println("å‰æ–¹æœªæ£€æµ‹åˆ°ä»»ä½•äº‹ç‰©");
  }
  else{
    //åœ¨æ­¤æ‹†åˆ†åˆ°4ä¸ªå˜é‡å½“ä¸­ Stringçš„å¤§çš„è½¬åˆ°å››ä¸ªå°çš„ int abcdå˜é‡ éœ€è¦å¼ºåˆ¶è½¬æ¢ä¸€ä¸‹ è²Œä¼¼ä¸éœ€è¦ å­—ç¬¦ä¸²åˆ¤æ–­å°±è¡Œ
    Serial.print("å‰æ–¹å…±æœ‰");
    
    switch(sub_0_int){//äºº
      case 0: ; break; //æ²¡æœ‰æ£€æµ‹åˆ°a ä¸æ’­æŠ¥
      case 1: Serial.print("1");Serial.println("ä¸ªäºº"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 2: Serial.print("2");Serial.println("ä¸ªäºº"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 3: Serial.print("3");Serial.println("ä¸ªäºº"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
    }
    

    switch(sub_1_int){//è‡ªè¡Œè½¦
      case 0: ; break; 
      case 1: Serial.print("1");Serial.println("è¾†è‡ªè¡Œè½¦"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 2: Serial.print("2");Serial.println("è¾†è‡ªè¡Œè½¦"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 3: Serial.print("3");Serial.println("è¾†è‡ªè¡Œè½¦"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
    }


    switch(sub_2_int){//æ±½è½¦
      case 0: ; break; 
      case 1: Serial.print("1");Serial.println("è¾†æ±½è½¦"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 2: Serial.print("2");Serial.println("è¾†æ±½è½¦"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 3: Serial.print("3");Serial.println("è¾†æ±½è½¦"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
    }


     switch(sub_4_int){//å…¬äº¤è½¦
      case 0: ; break; 
      case 1: Serial.print("1");Serial.println("è¾†å…¬å…±æ±½è½¦"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 2: Serial.print("2");Serial.println("è¾†å…¬å…±æ±½è½¦"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 3: Serial.print("3");Serial.println("è¾†å…¬å…±æ±½è½¦"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
    }


     switch(sub_7_int){//ç‹—
      case 0: ; break; 
      case 1: Serial.print("1");Serial.println("æ¡ç‹—"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 2: Serial.print("2");Serial.println("æ¡ç‹—"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 3: Serial.print("3");Serial.println("æ¡ç‹—"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
    }
 }


}

```




## å›¾ç‰‡ï¼šä¸²å£ç»„åˆå®ç°ç»“æœ â™¥
å…ˆç”¨ä¸²å£æ‰“å°æ¨¡æ‹Ÿ å®Œå…¨æ­£ç¡® å®Œå…¨åˆé€‚
![](201903040009images.aasts/image-20230420220104855.png)


![](201903040009images.aasts/image-20230420220014058.png)

ç›®å‰åªæ”¯æŒæ¯ç§ç‰©å“æœ€å¤šä¸‰ä¸ª å› ä¸ºå¤ªå¤šäº†æˆ‘æ€•è¯­éŸ³æ’­æŠ¥å ç©ºå¤ªå¤š æˆ‘æ€•å¤ªå¡äº†


## ç»†èŠ‚ï¼šè¯­éŸ³ç»„åˆå®ç°ç»“æœ
2023.04.21 ä¸‹åˆ æ­£ç¡®å®ç°äº†è¯­éŸ³æ’­æŠ¥ ç»„åˆæ’­æŠ¥å†…å®¹


### ç¡¬ä»¶ä»£ç éœ€è¦æ³¨æ„
ä¸²å£é€šä¿¡é€Ÿç‡å¿…é¡»ä¿æŒä¸€è‡´  æˆ‘å…¨è®¾ç½®æˆ9600äº†
```c
//ç”±äºArduino IDEç¼–ç é—®é¢˜ï¼Œåœ¨Arduinoä¸Šä½¿ç”¨æ—¶éœ€è¦å°†è¦å‘é€çš„æ–‡å­—è½¬åŒ–æˆ16è¿›åˆ¶å‘é€ï¼Œè¯·ä½¿ç”¨Arduinoå‡½æ•°ç”Ÿæˆå™¨è½¬æ¢
//æ­¤å¤„å‘é€å†…å®¹ä¸ºï¼š[m4][v16][t5]æ¬¢è¿ä½¿ç”¨ç»¿æ·±æ——èˆ°åº—SYN6288è¯­éŸ³åˆæˆæ¨¡å—
//m[0~16]:0èƒŒæ™¯éŸ³ä¹ä¸ºé™éŸ³ï¼Œ16èƒŒæ™¯éŸ³ä¹éŸ³é‡æœ€å¤§
//v[0~16]:0æœ—è¯»éŸ³é‡ä¸ºé™éŸ³ï¼Œ16æœ—è¯»éŸ³é‡æœ€å¤§
//t[0~5]:0æœ—è¯»è¯­é€Ÿæœ€æ…¢ï¼Œ5æœ—è¯»è¯­é€Ÿæœ€å¿«
//å…¶ä»–ä¸å¸¸ç”¨åŠŸèƒ½è¯·å‚è€ƒæ•°æ®æ‰‹å†Œ
```

1. è¯­éŸ³æ¨¡å—æºç ç”Ÿæˆå™¨éœ€è¦åœ¨å‰æ–¹æ·»åŠ ä¸‰ä¸ªå…³é”®å­—è‡ªå®šä¹‰èƒŒæ™¯éŸ³ä¹å’Œæœ—è¯»å£°éŸ³ä»¥åŠæœ—è¯»è¯­é€Ÿ
![](201903040009images.aasts/image-20230421180725514.png)

2. æ³¨æ„å»¶æ—¶
   è¿™ä¸ªè½¬ç æ—¶é—´å¥½åƒä¸æ˜¯å¿…é¡»çš„ å»¶æ—¶æ˜¯å¿…é¡»çš„ ä¸ç„¶æ’­æŠ¥ä¸å®Œå°±åœäº†

```c
  delay(500);//å¥½åƒéœ€è¦ä¸€ç‚¹çŸ­æš‚çš„è½¬ç çš„æ—¶é—´ åœ¨æ’­æŠ¥ä¹‹å‰ä¸€ç‚¹çŸ­æš‚çš„å»¶æ—¶
  speech();//å‡å¦‚ 5sæ‰èƒ½è¯´å®Œ ä¸‹é¢å°±è¦5000msçš„å»¶æ—¶ å¦åˆ™æ’­æŠ¥ä¸å®Œå…¨
  delay(5000); //5sçš„å»¶æ—¶ ç­‰å¾…å®Œå…¨æ’­æŠ¥å®Œæˆ
  
  delay(500);//çŸ­æš‚çš„è½¬ç ä¸‹é¢è¿™ä¸ªå¥å­çš„
  speech1();//å‡å¦‚3sæ‰èƒ½è¯´å®Œ
  delay(3000); //3sçš„å»¶æ—¶ ç­‰å¾…å®Œå…¨æ’­æŠ¥å®Œæˆ
```

### è½¯ä»¶ä»£ç éœ€è¦æ³¨æ„
1. æ³¨æ„æ‘„åƒå¤´RTSPæµåœ°å€çš„æ›¿æ¢ æ¯æ¬¡å±€åŸŸç½‘è‡ªåŠ¨çƒ­ç‚¹åˆ†é…çš„ipä¸ä¸€å®š
![](201903040009images.aasts/image-20230421181616594.png)

`ipçš„æŸ¥çœ‹æ–¹å¼`
ç”±äºæˆ‘ESP32-CAMçš„ RTSPæ–¹å¼æ’­æ”¾ç¨‹åºå·²ç»çƒ§å½•è¿›å»äº† ä¸‹æ¬¡åªéœ€è¦æ’ä¸Šç”µå°±ä¼šè‡ªåŠ¨è¿æ¥æˆ‘çš„çƒ­ç‚¹
çƒ­ç‚¹åç§°ï¼šcbxg
çƒ­ç‚¹å¯†ç ï¼š12345678

![](201903040009images.aasts/image-20230421181919935.png)
#### å¦‚ä½•æŸ¥çœ‹è¿æ¥åˆ°æ‰‹æœºçƒ­ç‚¹çš„ipåœ°å€
å®‰è£…ä¸€ä¸ª [android terminal](https://jackpal.github.io/Android-Terminal-Emulator/downloads/Term.apk) ( å®‰å“å‘½ä»¤è¡Œ),è¿™æ˜¯ä¸€ä¸ªå¼€æºç¨‹åºï¼Œç›®çš„æ˜¯åœ¨å®‰å“ä¸Šä¹Ÿæ¨¡æ‹Ÿå‡ºå‘½ä»¤è¡Œçš„æ•ˆæœï¼Œå®‰è£…æˆåŠŸåå°±æ˜¯ä¸€ä¸ªå’Œlinux å‘½ä»¤è¡Œç›¸ä¼¼çš„ç•Œé¢ï¼Œå®ƒå¯ä»¥æ”¯æŒéƒ¨åˆ†çš„æŒ‡ä»¤ï¼Œ(å½“ä¸€ä¸ª$ç¬¦å·å‡ºç°æ—¶ï¼Œè¯´æ˜å®ƒåœ¨ç­‰å¾…ç”¨æˆ·è¾“å…¥å‘½ä»¤ï¼Œå¦‚æœæ²¡æœ‰$ç¬¦å·è¯•è¯•ï¼ŒæŒ‰åŠ å·æ–°å»ºä¸€ä¸ªçª—å£ï¼‰ï¼Œ è¾“å…¥æŒ‡ä»¤Â **ip neigh**Â å°±èƒ½è·å¾—ç›¸å…³çš„ipåœ°å€ä¿¡æ¯å•¦ï¼ç»“æœå›¾å¦‚ä¸‹ï¼š![](201903040009images.aasts/1682072509-84eb03ff9b54eb0798cafa39f2e02c4e.jpg)
ç¬¬ä¸€è¡Œ wlan0 æ˜¯æ‰‹æœºçƒ­ç‚¹è‡ªèº«çš„ipåœ°å€ï¼Œå…¶åæ˜¯æ‰‹æœº"ç½‘å¡"çš„macåœ°å€ï¼Œä¸‹é¢ä¸¤ä¸ªå°±æ˜¯è¿åˆ°æ‰‹æœºä¸Šçš„ä¸¤ä¸ªè®¾å¤‡çš„ipåœ°å€,




## è¿è¡Œæµç¨‹




# è½¯ä»¶ä»£ç 

```python
# tag æ›´æ”¹
# èåˆå›¾åƒè¯†åˆ«å¹¶å‘å¸ƒ æŠ“å–RTSPæµçª—å£ æŠ“å–å›¾åƒä¿å­˜
# 2023.04.16 created by å¾æ¢¦æ˜Š
# python3.6
# -*- coding: utf-8 -*-
import paho.mqtt.client as mqtt
import random

# -*- coding: UTF-8 -*-
# cmdä¾èµ–
import os, sys, re

# æˆªå›¾æŒ‡å®šhwndçš„çª—å£ å¹¶æˆªå›¾ä¿å­˜
# å…ˆå¼•å…¥ä¾èµ–åŒ… pip install PyQt5
# æœ€å¼€å§‹è¿è¡Œçš„æ—¶å€™å…ˆæ³¨é‡Šæ‰ä¸‹é¢çš„hwnd ä»¥ä¸‹çš„ç¨‹åº å› ä¸ºhwndæˆ‘è¦å…ˆè·‘ä¸Šé¢çš„ç¨‹åºè·å– å¯ä»¥å…ˆæ”¾å¼€ä¸‹ä¸€è¡Œhwndä¸‡é‡‘æ²¹è¿è¡Œä¸€é è¿™æ ·ä¸ç”¨æ³¨é‡Š
# æˆªå›¾ä¾èµ–
import win32gui
import win32con
from PyQt5.QtWidgets import QApplication
from PIL import ImageGrab

# import win32com
import win32com.client
import pythoncom

# opencv æŠ“å–rtspè§†é¢‘æµ
import cv2

# æ–‡ä»¶ç§»åŠ¨
import shutil


broker = 'broker.emqx.io'
port = 1883
topic_button = "cc36e70148924ef2bb2e1d477c24675f_button" # è®¢é˜…è¿™ä¸ªä¸»é¢˜ ç­‰å¾…æŒ‰é”®å‘å¸ƒâ€œ1â€
topic_mp3 = "cc36e70148924ef2bb2e1d477c24675f_mp3" # å°†è¯†åˆ«ä¿¡æ¯å‘å¸ƒåˆ°è¿™ä¸ªä¸»é¢˜
# generate client ID with pub prefix randomly
client_id = f'python-mqtt-{random.randint(0, 100)}'


# è®¢é˜…å‡½æ•°
class MqttRoad(object):
 
    def __init__(self, mqtt_host, mqtt_port, mqtt_keepalive):
        super(MqttRoad, self).__init__()
        client = mqtt.Client()
        client.on_connect = self.on_connect
        client.on_message = self.on_message
        client.on_publish = self.on_publish
        client.connect(mqtt_host, mqtt_port, mqtt_keepalive)  # 600ä¸ºkeepaliveçš„æ—¶é—´é—´éš”
        client.loop_forever()  # ä¿æŒè¿æ¥
 
    def on_connect(self, client, userdata, flags, rc):
        print("Connected with result code: " + str(rc))
        # è®¢é˜… #tag
        client.subscribe(topic_button)
 
 
    def on_message(self, client, userdata, msg):
        print("on_message topic:" + msg.topic + " message:" + str(msg.payload.decode('utf-8')))
        strmqtt = str(msg.payload.decode('utf-8'))
        #tag æ¥æ”¶æ¶ˆæ¯ è¿›è¡Œåˆ¤æ–­
        if strmqtt == "1":
            print("æ¥æ”¶åˆ°æŒ‰é”®è¯·æ±‚ï¼Œè¯·æ±‚å‘å¸ƒç”»é¢è¯†åˆ«çš„è¯­éŸ³æ’­æŠ¥,ä¸‹é¢å¼€å§‹ä¾æ¬¡æŠ“å–ã€æ‰§è¡Œè¯†åˆ«å‘½ä»¤ã€å¤„ç†æ–‡æœ¬ã€å‘å¸ƒæ¶ˆæ¯ï¼")
            screenshot_f()
            print("æŠ“å–æˆåŠŸï¼ä¸‹é¢æ‰§è¡Œyoloç®—æ³•---")

            getcmd_f()
            print("æ‰§è¡Œè¯†åˆ«å‘½ä»¤å·²ç»æˆåŠŸå®Œæˆï¼")

            file_f()
            print("å›¾åƒè¯†åˆ«ç”»é¢æ–‡ä»¶ç§»åŠ¨å·²ç»æˆåŠŸå®Œæˆï¼")

            txt_spilt_f()
            print("å¤„ç†æ–‡æœ¬æˆåŠŸå®Œæˆï¼")

            publish()
            print("è¯†åˆ«ä¿¡æ¯å·²å‘å¸ƒæˆåŠŸï¼")
        else:
            print("æœªæ”¶åˆ°æ­£ç¡®æŒ‰é”®è¯·æ±‚ å ç©ºç”¨")
        
 
    #   è®¢é˜…å›è°ƒ
    def on_subscribe(self, client, userdata, mid, granted_qos):
        print("On Subscribed: qos = %d" % granted_qos)
        pass
 
    #   å–æ¶ˆè®¢é˜…å›è°ƒ
    def on_unsubscribe(self, client, userdata, mid):
        # print("å–æ¶ˆè®¢é˜…")
        print("On unSubscribed: qos = %d" % mid)
        pass
 
    #   å‘å¸ƒæ¶ˆæ¯å›è°ƒ
    def on_publish(self, client, userdata, mid):
        # print("å‘å¸ƒæ¶ˆæ¯")
        print("On onPublish: qos = %d" % mid)
        pass
 
    #   æ–­å¼€é“¾æ¥å›è°ƒ
    def on_disconnect(self, client, userdata, rc):
        # print("æ–­å¼€é“¾æ¥")
        print("Unexpected disconnection rc = " + str(rc))
        pass
 
# å‘å¸ƒå‡½æ•°
def publish():
    def on_connect(client, userdata, flags, rc):
        print ("é“¾æ¥")
        print("Connected with result code: " + str(rc))
    
    
    def on_message(client, userdata, msg):
        print ("æ¶ˆæ¯å†…å®¹")
        print(msg.topic + " " + str(msg.payload))
    
    
    #   è®¢é˜…å›è°ƒ
    def on_subscribe(client, userdata, mid, granted_qos):
        print ("è®¢é˜…")
        print("On Subscribed: qos = %d" % granted_qos)
        pass
    
    
    #   å–æ¶ˆè®¢é˜…å›è°ƒ
    def on_unsubscribe(client, userdata, mid, granted_qos):
        print ("å–æ¶ˆè®¢é˜…")
        print("On unSubscribed: qos = %d" % granted_qos)
        pass
    
    
    #   å‘å¸ƒæ¶ˆæ¯å›è°ƒ
    def on_publish(client, userdata, mid):
        print ("å‘å¸ƒæ¶ˆæ¯")
        print("On onPublish: qos = %d" % mid)
        pass
    
    
    #   æ–­å¼€é“¾æ¥å›è°ƒ
    def on_disconnect(client, userdata, rc):
        print ("æ–­å¼€é“¾æ¥")
        print("Unexpected disconnection rc = " + str(rc))
        pass
    
    
    client = mqtt.Client()
    client.on_connect = on_connect
    client.on_message = on_message
    client.on_publish = on_publish
    client.on_disconnect = on_disconnect
    client.on_unsubscribe = on_unsubscribe
    client.on_subscribe = on_subscribe
    client.connect(broker, 1883, 600) # 600ä¸ºkeepaliveçš„æ—¶é—´é—´éš”

    # client.publish(topic_mp3, payload='å‰æ–¹å…±æœ‰1ä¸ªäºº 3è¾†æ±½è½¦ 1æ¡ç‹— ', qos=0, retain=False) #tagå‘å¸ƒæ¶ˆæ¯
    client.publish(topic_mp3, payload = message2, qos=0, retain=False) #message1ä¸ºå®Œæ•´ä¿¡æ¯ message2ä¸º8ä½ä»£ç 
    


# æŠ“å–RTSPæµçª—å£ æŠ“å–å›¾åƒä¿å­˜
def screenshot_f():
    # æ›´æ”¹
    url = 'rtsp://192.168.229.253:8554/mjpeg/2'
    cap = cv2.VideoCapture(url)
    flag = cap.isOpened()
    print(flag)

    # fps = cap.get(cv2.CAP_PROP_FPS)
    # width = int(cap.get(cv2.CAP_PROP_FRAME_WIDTH))
    # height = int(cap.get(cv2.CAP_PROP_FRAME_HEIGHT))
    # print(fps,width,height)

    (flag,frame) = cap.read()   #è¯»å–æ¯ä¸€å¸§ï¼Œflagè¡¨ç¤ºæ˜¯å¦è¯»å–æˆåŠŸï¼Œframeä¸ºå›¾ç‰‡å†…å®¹ã€‚
    fileName = "D:\Desktop\IOT_SoftWare\screenshot.jpg"
    # print(fileName)
    if flag == True:
        cv2.imwrite(fileName,frame,[cv2.IMWRITE_JPEG_QUALITY,100])

    cap.release() # é‡Šæ”¾æ‘„åƒå¤´
    cv2.destroyAllWindows()# é‡Šæ”¾å¹¶é”€æ¯çª—å£


# yolo çš„cmdè°ƒç”¨ ç”Ÿæˆè¦†ç›–çš„txtæ–‡æœ¬æ–‡ä»¶
def getcmd_f():
	'''
	å¤„ç†å›¾ç‰‡
	:param url:å›¾ç‰‡åœ°å€
	:return: å›¾ç‰‡ä¸­çš„äººæ•°
	'''
	cmd = r'd: && python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --conf-thres 0.6 --source D:\Desktop\IOT_SoftWare\screenshot.jpg --save-txt --class 0 1 2 3 5 9 13 16  --exist-ok'
	text = os.popen(cmd).readlines()
	print(text) #è¯»ä¸å‡ºæ¥ åªå¥½è¯»txtæ–‡ä»¶äº†



# txtæ–‡æœ¬ä¿¡æ¯å¤„ç†
def txt_spilt_f():
    f=open("D:/Desktop/yolov5-7.0/runs/detect/exp/labels/screenshot.txt","r", encoding = 'utf-8',errors='ignore')
    txt = [0,0,0,0,0,0,0,0]
    for line in f:
        # print(line.split(' ')[0]) # ä¸€æ­¥åˆ°ä½
        # a = line.split(' ')[0] # aä¸ºä»¥ç©ºæ ¼åˆ†éš”ä¹‹åçš„é¦–ä¸ªå…ƒç´   ä»ä¸ºå­—ç¬¦ç±»å‹
        a = int(line.split(' ')[0]) # aä¸ºä»¥ç©ºæ ¼åˆ†éš”ä¹‹åçš„é¦–ä¸ªå…ƒç´ [0]  æ¯ä¸€è¡Œä¸€å…±äº”åˆ— [0]-[4] 
        # print(a)
        if a == 0:# äºº
            txt[0] = txt[0] +1
        if a == 1: # è‡ªè¡Œè½¦
            txt[1] = txt[1] +1
        if a == 2: # æ±½è½¦
            txt[2] = txt[2] +1
        if a == 3: # æ‘©æ‰˜è½¦
            txt[3] = txt[3] +1
        if a == 5: # å…¬å…±æ±½è½¦
            txt[4] = txt[4] +1
        if a == 9: # äº¤é€šç¯
            txt[5] = txt[5] +1
        if a == 13: # é•¿æ¤…
            txt[6] = txt[6] +1
        if a == 16: # ç‹—
            txt[7] = txt[7] +1

    message = ""
    if txt[0] != 0:# äºº
        message = str(txt[0]) +"ä¸ªäºº "
    if txt[1] != 0: # è‡ªè¡Œè½¦
        message = message +  str(txt[1]) +"è¾†è‡ªè¡Œè½¦ "
    if txt[2] != 0: # æ±½è½¦
        message = message +  str(txt[2]) +"è¾†æ±½è½¦ "
    if txt[3] != 0: # æ‘©æ‰˜è½¦
        message = message +  str(txt[3]) +"è¾†æ‘©æ‰˜è½¦ "
    if txt[4] != 0: # å…¬å…±æ±½è½¦
        message = message +  str(txt[4]) +"è¾†å…¬å…±æ±½è½¦ "
    if txt[5] != 0: # äº¤é€šç¯
        message = message +  str(txt[5]) +"ä¸ªäº¤é€šç¯ "
    if txt[6] != 0: # é•¿æ¤…
        message = message +  str(txt[6]) +"ä¸ªé•¿æ¤… "
    if txt[7] != 0: # ç‹—
        message = message +  str(txt[7]) +"æ¡ç‹— "
    global message1 # è¯†åˆ«çš„å®Œæ•´ç»“æœ
    global message2 # è¯†åˆ«ç»“æœä»¥8ä¸ªåè¿›åˆ¶æ•°å±•ç¤º ï¼Œæ¯ä¸ªç§ç±»çš„æ•°ç›®ä¸èƒ½å¤§äº9
    message2 = str(txt[0])+str(txt[1])+str(txt[2])+str(txt[3])+str(txt[4])+str(txt[5])+str(txt[6])+str(txt[7])
    message1= "å‰æ–¹å…±æœ‰"+ message
    print("message1:",end="");print (message1)
    print("message2:",end="");print (message2)

def file_f():
        argetdir_path = 'D:\\Desktop\\yolov5-7.0\\runs\\detect\\exp\\screenshot.jpg'
        Targetfile_path = 'D:\\Desktop\\IOT_SoftWare\\app01\\static\\YoloImages\\screenshot_django.jpg'
        shutil.copyfile(argetdir_path, Targetfile_path)

 
if __name__ == '__main__':
    MqttRoad(broker, 1883, 600)

```


# ç¡¬ä»¶ä»£ç 

```c
#include <ESP8266WiFi.h>
#include <PubSubClient.h>
//GPS ç»çº¬åº¦æå–åˆ†ç¦» library for GPS module
#include <TinyGPS++.h> 
//GPS RX TX è½¯è½¬ æ¢è½¯ä¸²å£åº“
#include <SoftwareSerial.h> 
#include "Timer.h"
#include "pinMapping.h" //å¼•è„šå®šä¹‰ ç›´æ¥å¼•ç”¨Dx
WiFiClient espClient;
PubSubClient client(espClient);
Timer t;

//SoftwareSerialç±»åº“ï¼Œå®ƒå¯ä»¥å°†ä½ çš„å…¶ä»–æ•°å­—å¼•è„šé€šè¿‡ç¨‹åºæ¨¡æ‹Ÿæˆä¸²å£é€šä¿¡å¼•è„š ã€è½¯ä»¶æ¨¡æ‹Ÿä¸²å£ã€‘
//ESP8266éœ€è¦è°ƒç”¨è½¯ä¸²å£åº“æ‰æœ‰è¿™ä¸ªåŠŸèƒ½ï¼Œ#include <SoftwareSerial.h>
// The serial connection to the GPS device /GPIO5 D1-RX  GPIO4 D2-TX
TinyGPSPlus gps;
SoftwareSerial ss(4, 5); //RX TX æ˜ å°„
float latitude;//çº¬åº¦
float longitude;//ç»åº¦

// WiFi 
const char* ssid = "cbxg";
const char* password = "12345678";

// MQTT Broker
const char *mqtt_broker = "broker.emqx.io";
const char *topic1 = "cc36e70148924ef2bb2e1d477c24675f_mp3";//ç»ˆç«¯æ”¶ æ¥æ”¶è¯·æ±‚è¯†åˆ«ä¿¡æ¯01234567
const char *topic2 = "cc36e70148924ef2bb2e1d477c24675f_button";//ç»ˆç«¯å‘ æŒ‰é”®ä¹‹åå‘é€1 è¯·æ±‚è¯†åˆ«ä¿¡æ¯
const char *topic3 = "cc36e70148924ef2bb2e1d477c24675f_gps";//ç»ˆç«¯å‘ GPSå›ºå®šæ—¶é—´é—´éš”å‘é€
const char *mqtt_username = "root";
const char *mqtt_password = "root0410";
const int mqtt_port = 1883;

//// è¶…å£°æ³¢ å››ä¸ªå¼•è„š D2 D1 GND 3V3
//// define ultrasonic signal receiver pin  ECHO to D2  GPIO4
//int ECHOPin = D2;  
//// define ultrasonic signal transmitter pin  TRIG to D1  GPIO5
//int TRIGPin = D1;  

//ä¼ æ„Ÿå™¨æ”¶é›†å˜é‡å­˜å‚¨ å®šä¹‰å˜é‡
int utlDistance;  //è¶…å£°æ³¢è·ç¦» å˜é‡å­˜å‚¨
double waterHigh;//å­˜å‚¨æ°´ä½
int lightIntensity;//å­˜å‚¨å…‰ç…§å¼ºåº¦0~99

//ä¸‰ä¸ªååº”æ¨¡å— å¼•è„šå®šä¹‰
//int ledPinUlt = D3; //è¶…å£°æ³¢è·ç¦»é¢„è­¦ç¯å…‰ ä¿ç•™éœ‡åŠ¨ç”¨
//int ledPinWater = D4;  //æ°´ä½è¿‡é«˜éœ‡åŠ¨ç”¨
int ledPinLight = D3;  //å…‰ç…§è¿‡ä½ ç¯å…‰ç‚¹äº®æé†’è·¯äºº

int LED = D6;  //ç”¨äºè¿œç¨‹æ“æ§ç¯å…‰  æ•ˆåº”å™¨

long lastMsg = 0; //å®šæ—¶å™¨æ ‡å¤´

int KEY=D5;//KEYå¯¹åº”D5 
char flag=1;

//GPSç»„åˆç»çº¬åº¦çš„å­—ç¬¦ä¸²å˜é‡
char msg[50];



////////////////////////setupå‡½æ•°/////////////////////////////////////
void setup() {
// ç”¨äºä¸²å£é€šä¿¡é€Ÿç‡è®¾ç½®
    //set the baud rate of serial port to 115200;
    Serial.begin(9600);
    //set the GPS baud rate to 9600;
    ss.begin(9600); 

//ç”¨äºå¼•è„šæ¨¡å¼è®¾ç½®
//    //è¿œç¨‹æ§åˆ¶çš„ç¯å…‰ è®¾ç½®ä¸ºè¾“å‡ºæ¨¡å¼
//    pinMode(LED, OUTPUT);  
//
//    //æœ¬åœ°éœ‡åŠ¨1 è¶…å£°æ³¢è¿‡è¿‘éœ‡åŠ¨ è®¾ç½®ä¸ºè¾“å‡ºæ¨¡å¼
//    pinMode(ledPinUlt, OUTPUT);  
//
//    //æœ¬åœ°éœ‡åŠ¨2 æ°´ä½è¿‡é«˜éœ‡åŠ¨ è®¾ç½®ä¸ºè¾“å‡ºæ¨¡å¼
//    pinMode(ledPinWater, OUTPUT);  

    //æœ¬åœ°å…‰ç…§3 å…‰æ•ä¼ æ„Ÿå™¨æ¥æ”¶çš„å…‰ç…§è¿‡ä½ ç‚¹äº® è®¾ç½®ä¸ºè¾“å‡ºæ¨¡å¼
    pinMode(ledPinLight,OUTPUT);
  
//    //è¶…å£°æ³¢ä¼ æ„Ÿå™¨ ä¸¤ä¸ªå¼•è„šå®šä¹‰ ä¸€ä¸ªè¾“å…¥ ä¸€ä¸ªè¾“å‡º
//    pinMode(ECHOPin, INPUT); // Sets the echoPin as an Input
//    pinMode(TRIGPin, OUTPUT);// Sets the trigPin as an Output

    //å‘é€å›¾åƒè¯†åˆ«ä¿¡æ¯è¯·æ±‚çš„æŒ‰é”®
    pinMode(KEY,INPUT_PULLUP);//å°†GPIO14 D5 æŒ‰é”®è®¾ç½®ä¸ºä¸Šæ‹‰è¾“å…¥æ¨¡å¼

  
//ç”¨äºè¿æ¥wifi
    WiFi.begin(ssid, password);
    while (WiFi.status() != WL_CONNECTED) {
        delay(500);
        Serial.println("Connecting to WiFi..");
    }
    Serial.println("Connected to the WiFi network");
	  Serial.println("IP åœ°å€: ");
    Serial.println(WiFi.localIP());
  
  
//ç”¨äºè¿æ¥mqttæœåŠ¡ä»£ç†å•†
    client.setServer(mqtt_broker, mqtt_port);
    client.setCallback(callback);
    while (!client.connected()) {
        //ç”¨macåœ°å€åŒºåˆ†å”¯ä¸€ip
        String client_id = "esp8266-client-";
        client_id += String(WiFi.macAddress());
        //è¾“å‡ºå”¯ä¸€macæœåŠ¡åœ°å€
        Serial.println("--------Start - connects states ----------");
        Serial.printf("The client %s connects to the public mqtt broker\n", client_id.c_str());
        if (client.connect(client_id.c_str(), mqtt_username, mqtt_password)) {
            Serial.println("Public emqx mqtt broker connected");
        } else {
            Serial.print("failed with state ");
            Serial.print(client.state());
            delay(2000);
        }
        Serial.println("--------End - connects states ----------");
    }
  
  
//MQTTæ°¸ä¹…è®¢é˜…ä»¥åŠé¦–ä¸ªå‘å¸ƒæµ‹è¯•
    //é¦–ä¸ªå‘å¸ƒæµ‹è¯• å‘å¸ƒæŒ‰é”®çš„"1"è¯·æ±‚è¯†åˆ«ä¿¡æ¯
    client.publish(topic2, "the first publish test");
    //è®¢é˜…ä¸»é¢˜ æ¥æ”¶è¯†åˆ«ä¿¡æ¯
    client.subscribe(topic1);

}//setup end


////////////////////////loopå‡½æ•°/////////////////////////////////////
void loop() {

//MQTTé‡è¿æœºåˆ¶
//  if (!client.connected()) {
//    reconnect();
//  }

//MQTTä¸æ–­ç›‘å¬ä¿¡æ¯ ç”¨äºä¿æŒè®¢é˜…çŠ¶æ€
    client.loop();

//æ¯éš”ä¸¤ç§’è°ƒç”¨ä¸€æ¬¡è¶…å£°æ³¢å‡½æ•° åœ¨å†…éƒ¨è°ƒç”¨å‘å¸ƒå‡½æ•°
    long now = millis();
    if (now - lastMsg > 2000) {//å»¶æ—¶2s
       lastMsg = now;
       push_Ultrasound_Water();
       KEY_PROS();//æŒ‰é”®2Sä¸ºä¸€ä¸ªæ£€æµ‹å‘¨æœŸ åˆšå¥½ è§¦å‘è§†é¢‘å¸§è¯†åˆ«
       GPS_push();//GPS mqttæ¨¡æ‹Ÿå‘å¸ƒ
       
}

////GPSçš„ç»çº¬åº¦æ£€æµ‹å‡½æ•°
//    while (ss.available() > 0){
//      gps.encode(ss.read()); //The encode() method encodes the string in the encoding format specified by encoding.
//      if (gps.location.isUpdated())
//        {
//          Serial.println("--------Start - GPS - detect & publish----------");
//          latitude = gps.location.lat(); //gps.location.lat() can export latitude
//          longitude = gps.location.lng();//gps.location.lng() can export latitude
//          Serial.print("Latitude=");
//          Serial.print(latitude, 14);  
//          Serial.print(" Longitude=");
//          Serial.println(longitude, 14);
//          String s1 = String(latitude,14);
//          String s2 = String(longitude,14);
//          Serial.println(s1);
//          Serial.println(s2);
////          String data = String(latitude,14) + "," + String(longitude,14) ; 
////          Serial.println(data);
//          char c[50]; //é•¿åº¦50çš„å­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥char *Buff ;
//          sprintf(c, "%s", "36.56167324381701,116.80781175110624");   
//          client.publish(topic3,c);//å‘GPSä¸»é¢˜å‘å¸ƒç»çº¬åº¦ä¿¡æ¯ 'çº¬åº¦ï¼Œç»åº¦'
//          Serial.printf("Have published %s to the topic of cc36e70148924ef2bb2e1d477c24675f_gps", c); 
//          Serial.println();
//          Serial.println("--------End - GPS - detect & publish----------");
//          delay(3000);
//        }
//}
    


}


////////////////////////è‡ªå®šä¹‰å‡½æ•°/////////////////////////////////////

//ç”¨äºæ¥æ”¶æ¶ˆæ¯
void callback(char *topic1, byte *payload, unsigned int length) {
    Serial.println("--------Start - Message arrived ----------");
    Serial.print("Message arrived in topic: ");
    Serial.println(topic1);
    String message;
    for (int i = 0; i < length; i++) {
        //payload åœ¨å‚æ•°é‡Œçš„ç±»å‹æ˜¯ byte*
        message = message + (char) payload[i];  // convert *byte to string
    }
    Serial.print("Message:"); 
    Serial.println(message); //éœ€è¦è¯­éŸ³æ’­æŠ¥å‡ºæ¥
    delay(1000);
    mp3(message);//è°ƒç”¨è¯­éŸ³åŒ¹é…å‡½æ•°
    delay(1000);
    Serial.println();
    Serial.println("--------End - Message arrived ----------");
}


//ç”¨äºå‘é€è¶…å£°æ³¢æµ‹åˆ°çš„æ•°æ®å¹¶åœ¨è¶…å£°æ³¢æµ‹è·è¿‡è¿‘æé†’
void push_Ultrasound_Water() {
  

//å…‰ç…§æ£€æµ‹  åªæœ¬åœ°
    Serial.println("--------Start - Light - detect----------");
    Serial.print("å…‰ç…§å¼ºåº¦ï¼š "); 
    lightIntensity = shine();
    Serial.println(lightIntensity);  //ä¸²å£ç›‘è§†å™¨æ˜¾ç¤ºå…‰ç…§å¼ºåº¦
//    Serial.print("\n");  //å›è½¦
    if(lightIntensity < 60){
      digitalWrite(ledPinLight,HIGH);//å½“å…‰ç…§å¼ºåº¦å°äº30ï¼Œç‚¹äº®LED D3å¼•è„š
    }
    else{
      digitalWrite(ledPinLight,LOW);
    }
    Serial.println("--------End - Light - detect----------");
    

    
////è¶…å£°æ³¢å’Œæ°´ä½ä»¥â€œ10ï¼Œ10.00â€å½¢å¼ä¸€èµ·å‘å¸ƒ,è‹±æ–‡é€—å·åˆ†å‰²å½¢æˆå®Œæ•´å­—ç¬¦ä¸²å‘å¸ƒ
//    Serial.println("--------Start - Ultrasound&&Water - publish - ----------");
//    char text[20]; //é•¿åº¦20çš„å­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥char *Buff ;
//    sprintf(text, "%d%s%lf", utlDistance, "  ,  " , waterHigh); 
//    client.publish(topic,text);
//    Serial.printf("Have published %s to the topic of cc36e70148924ef2bb2e1d477c24675f", text); 
//    Serial.println("--------End - Ultrasound&&Water - publish----------");
}


//å…‰ç…§å¼ºåº¦æ˜ å°„å‡½æ•°
int shine(){
  int i=analogRead(A0);//å…‰æ„Ÿæ¨¡æ‹Ÿå£æ¥esp8266AOå£
  i=1023-i;
  i=i/10.23-1;   //å°†å…‰ç…§å¼ºåº¦è®¾ç½®ä¸º0-99
  return i;
}


//æŒ‰é”®å¤„ç†å‡½æ•°
void KEY_PROS()
{
  if(digitalRead(KEY)==0){
    delay(5);
    if(digitalRead(KEY)==0){ //å¦‚æœæ¥åœ°äº†
      client.publish(topic2,"1"); //å‘å¸ƒâ€œ1â€ å ä½
      Serial.println("å·²ç»å‘é€1åˆ°buttonä¸»é¢˜.");
    }
  }
  
  else if(digitalRead(KEY)==1){//KEYæ¥åœ°ä¸º0 ä¸æ¥åœ°ä¸º1
  
  }
  
//  switch (temp){
//    case 1:alarm();break; //æ’å…¥æ¥åœ° ç‚¹äº® å‘é€é‚®ä»¶
//    case 0: ;break; //å†æ’å…¥æ¥åœ° å†æŒ‰ä¸€ä¸‹ æ¨¡æ‹Ÿæ˜¾ç¤ºç«¯åé¦ˆå å†æŒ‰ä¸€ä¸‹å†å‘é€ä»£è¡¨è¯¯è§¦çš„é‚®ä»¶
//  }
  
}

//GPSæ¨¡æ‹Ÿå¤„ç†å‡½æ•°
void GPS_push()
{
  char c[50]; //é•¿åº¦50çš„å­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥char *Buff ;
  sprintf(c, "%s", "36.56167324381701,116.80781175110624");   
  client.publish(topic3,c);//å‘GPSä¸»é¢˜å‘å¸ƒç»çº¬åº¦ä¿¡æ¯ 'çº¬åº¦ï¼Œç»åº¦'
  Serial.printf("Have published GPS to the topic of cc36e70148924ef2bb2e1d477c24675f_gps"); 

  
}


//è¯­éŸ³æ’­æŠ¥å‡½æ•°
void mp3(String message){
  // 0 1 2 4 7
    String sub_0 = message.substring(0,1);//äºº
    String sub_1 = message.substring(1,2);//è‡ªè¡Œè½¦
    String sub_2 = message.substring(2,3);//æ±½è½¦
    String sub_4 = message.substring(4,5);//å…¬äº¤è½¦
    String sub_7 = message.substring(7,8);//ç‹—
    int sub_0_int =(sub_0).toInt();
    int sub_1_int =(sub_1).toInt();
    int sub_2_int =(sub_2).toInt();
    int sub_4_int =(sub_4).toInt();
    int sub_7_int =(sub_7).toInt();
   

   if(message == "00000000"){
    delay(1000);speech00();delay(1800);
    Serial.println("å‰æ–¹æœªæ£€æµ‹åˆ°äº‹ç‰©");//00
  }
  else{
    //åœ¨æ­¤æ‹†åˆ†åˆ°4ä¸ªå˜é‡å½“ä¸­ Stringçš„å¤§çš„è½¬åˆ°å››ä¸ªå°çš„ int abcdå˜é‡ éœ€è¦å¼ºåˆ¶è½¬æ¢ä¸€ä¸‹ è²Œä¼¼ä¸éœ€è¦ å­—ç¬¦ä¸²åˆ¤æ–­å°±è¡Œ
    delay(500);speech01();delay(1500);
    Serial.print("å‰æ–¹å…±æœ‰");//01
    
    switch(sub_0_int){//äºº
      case 0: ; break; //æ²¡æœ‰æ£€æµ‹åˆ°a ä¸æ’­æŠ¥
      case 1: delay(500);speech11();delay(800);Serial.print("1");delay(500);speech0();delay(800);Serial.println("ä¸ªäºº"); break; //æ£€æµ‹åˆ°1ä¸ªa ,æ’­æŠ¥ 'ä¸€'
      case 2: delay(500);speech12();delay(800);Serial.print("2");delay(500);speech0();delay(800);Serial.println("ä¸ªäºº"); break; 
      case 3: delay(500);speech13();delay(800);Serial.print("3");delay(500);speech0();delay(800);Serial.println("ä¸ªäºº"); break; 
    }
    

    switch(sub_1_int){//è‡ªè¡Œè½¦
      case 0: ; break; 
      case 1: delay(500);speech11();delay(800);Serial.print("1");delay(500);speech1();delay(1500);Serial.println("è¾†è‡ªè¡Œè½¦"); break; 
      case 2: delay(500);speech12();delay(800);Serial.print("2");delay(500);speech1();delay(1500);Serial.println("è¾†è‡ªè¡Œè½¦"); break;
      case 3: delay(500);speech13();delay(800);Serial.print("3");delay(500);speech1();delay(1500);Serial.println("è¾†è‡ªè¡Œè½¦"); break; 
    }


    switch(sub_2_int){//æ±½è½¦
      case 0: ; break; 
      case 1: delay(500);speech11();delay(800);Serial.print("1");delay(500);delay(500);speech2();delay(1000);Serial.println("è¾†æ±½è½¦"); break;
      case 2: delay(500);speech12();delay(800);Serial.print("2");delay(500);delay(500);speech2();delay(1000);Serial.println("è¾†æ±½è½¦"); break;
      case 3: delay(500);speech13();delay(800);Serial.print("3");delay(500);delay(500);speech2();delay(1000);Serial.println("è¾†æ±½è½¦"); break;
    }


     switch(sub_4_int){//å…¬äº¤è½¦
      case 0: ; break; 
      case 1: delay(500);speech11();delay(800);Serial.print("1");delay(500);speech4();delay(1500);Serial.println("è¾†å…¬å…±æ±½è½¦"); break;
      case 2: delay(500);speech12();delay(800);Serial.print("2");delay(500);speech4();delay(1500);Serial.println("è¾†å…¬å…±æ±½è½¦"); break; 
      case 3: delay(500);speech13();delay(800);Serial.print("3");delay(500);speech4();delay(1500);Serial.println("è¾†å…¬å…±æ±½è½¦"); break; 
    }


     switch(sub_7_int){//ç‹—
      case 0: ; break; 
      case 1: delay(500);speech11();delay(800);Serial.print("1");delay(500);speech7();delay(800);Serial.println("æ¡ç‹—"); break; 
      case 2: delay(500);speech12();delay(800);Serial.print("2");delay(500);speech7();delay(800);Serial.println("æ¡ç‹—"); break;
      case 3: delay(500);speech13();delay(800);Serial.print("3");delay(500);speech7();delay(800);Serial.println("æ¡ç‹—"); break;
    }
 }


}


void speech00(){//å‰æ–¹æœªæ£€æµ‹åˆ°äº‹ç‰©
  unsigned char i = 0;
  unsigned char head[34];

  head[0] = 0xFD;
  head[1] = 0x00;
  head[2] = 0x1F;
  head[3] = 0x01;
  head[4] = 0x00;
  head[5] = 0x5B;
  head[6] = 0x6D;
  head[7] = 0x34;
  head[8] = 0x5D;
  head[9] = 0x5B;
  head[10] = 0x76;
  head[11] = 0x35;
  head[12] = 0x5D;
  head[13] = 0x5B;
  head[14] = 0x74;
  head[15] = 0x35;
  head[16] = 0x5D;
  head[17] = 0xC7;
  head[18] = 0xB0;
  head[19] = 0xB7;
  head[20] = 0xBD;
  head[21] = 0xCE;
  head[22] = 0xB4;
  head[23] = 0xBC;
  head[24] = 0xEC;
  head[25] = 0xB2;
  head[26] = 0xE2;
  head[27] = 0xB5;
  head[28] = 0xBD;
  head[29] = 0xCA;
  head[30] = 0xC2;
  head[31] = 0xCE;
  head[32] = 0xEF;
  head[33] = 0x98;

  for(i=0; i<34; i++){
    Serial.write(head[i]);
  }
}

void speech01(){//å‰æ–¹å…±æœ‰
  unsigned char i = 0;
  unsigned char head[26];

  head[0] = 0xFD;
  head[1] = 0x00;
  head[2] = 0x17;
  head[3] = 0x01;
  head[4] = 0x00;
  head[5] = 0x5B;
  head[6] = 0x6D;
  head[7] = 0x34;
  head[8] = 0x5D;
  head[9] = 0x5B;
  head[10] = 0x76;
  head[11] = 0x35;
  head[12] = 0x5D;
  head[13] = 0x5B;
  head[14] = 0x74;
  head[15] = 0x35;
  head[16] = 0x5D;
  head[17] = 0xC7;
  head[18] = 0xB0;
  head[19] = 0xB7;
  head[20] = 0xBD;
  head[21] = 0xB9;
  head[22] = 0xB2;
  head[23] = 0xD3;
  head[24] = 0xD0;
  head[25] = 0xC3;

  for(i=0; i<26; i++){
    Serial.write(head[i]);
  }
}

void speech0(){//ä¸ªäºº
  unsigned char i = 0;
  unsigned char head[22];

  head[0] = 0xFD;
  head[1] = 0x00;
  head[2] = 0x13;
  head[3] = 0x01;
  head[4] = 0x00;
  head[5] = 0x5B;
  head[6] = 0x6D;
  head[7] = 0x34;
  head[8] = 0x5D;
  head[9] = 0x5B;
  head[10] = 0x76;
  head[11] = 0x35;
  head[12] = 0x5D;
  head[13] = 0x5B;
  head[14] = 0x74;
  head[15] = 0x35;
  head[16] = 0x5D;
  head[17] = 0xB8;
  head[18] = 0xF6;
  head[19] = 0xC8;
  head[20] = 0xCB;
  head[21] = 0xFF;

  for(i=0; i<22; i++){
    Serial.write(head[i]);
  }
}

void speech1(){
  unsigned char i = 0;
  unsigned char head[14];

  head[0] = 0xFD;
  head[1] = 0x00;
  head[2] = 0x0B;
  head[3] = 0x01;
  head[4] = 0x00;
  head[5] = 0xC1;
  head[6] = 0xBE;
  head[7] = 0xD7;
  head[8] = 0xD4;
  head[9] = 0xD0;
  head[10] = 0xD0;
  head[11] = 0xB3;
  head[12] = 0xB5;
  head[13] = 0x8D;

  for(i=0; i<14; i++){
    Serial.write(head[i]);
  }
}

void speech2(){
  unsigned char i = 0;
  unsigned char head[12];

  head[0] = 0xFD;
  head[1] = 0x00;
  head[2] = 0x09;
  head[3] = 0x01;
  head[4] = 0x00;
  head[5] = 0xC1;
  head[6] = 0xBE;
  head[7] = 0xC6;
  head[8] = 0xFB;
  head[9] = 0xB3;
  head[10] = 0xB5;
  head[11] = 0xB1;

  for(i=0; i<12; i++){
    Serial.write(head[i]);
  }
}

void speech4(){
  unsigned char i = 0;
  unsigned char head[16];

  head[0] = 0xFD;
  head[1] = 0x00;
  head[2] = 0x0D;
  head[3] = 0x01;
  head[4] = 0x00;
  head[5] = 0xC1;
  head[6] = 0xBE;
  head[7] = 0xB9;
  head[8] = 0xAB;
  head[9] = 0xB9;
  head[10] = 0xB2;
  head[11] = 0xC6;
  head[12] = 0xFB;
  head[13] = 0xB3;
  head[14] = 0xB5;
  head[15] = 0xAC;

  for(i=0; i<16; i++){
    Serial.write(head[i]);
  }
}

void speech7(){
  unsigned char i = 0;
  unsigned char head[10];

  head[0] = 0xFD;
  head[1] = 0x00;
  head[2] = 0x07;
  head[3] = 0x01;
  head[4] = 0x00;
  head[5] = 0xCC;
  head[6] = 0xF5;
  head[7] = 0xB9;
  head[8] = 0xB7;
  head[9] = 0xCC;

  for(i=0; i<10; i++){
    Serial.write(head[i]);
  }
}

void speech11(){//1
  unsigned char i = 0;
  unsigned char head[20];

  head[0] = 0xFD;
  head[1] = 0x00;
  head[2] = 0x11;
  head[3] = 0x01;
  head[4] = 0x00;
  head[5] = 0x5B;
  head[6] = 0x6D;
  head[7] = 0x34;
  head[8] = 0x5D;
  head[9] = 0x5B;
  head[10] = 0x76;
  head[11] = 0x35;
  head[12] = 0x5D;
  head[13] = 0x5B;
  head[14] = 0x74;
  head[15] = 0x35;
  head[16] = 0x5D;
  head[17] = 0xD2;
  head[18] = 0xBB;
  head[19] = 0xD9;

  for(i=0; i<20; i++){
    Serial.write(head[i]);
  }
}

void speech12(){//2
  unsigned char i = 0;
  unsigned char head[20];

  head[0] = 0xFD;
  head[1] = 0x00;
  head[2] = 0x11;
  head[3] = 0x01;
  head[4] = 0x00;
  head[5] = 0x5B;
  head[6] = 0x6D;
  head[7] = 0x34;
  head[8] = 0x5D;
  head[9] = 0x5B;
  head[10] = 0x76;
  head[11] = 0x35;
  head[12] = 0x5D;
  head[13] = 0x5B;
  head[14] = 0x74;
  head[15] = 0x35;
  head[16] = 0x5D;
  head[17] = 0xC1;
  head[18] = 0xBD;
  head[19] = 0xCC;

  for(i=0; i<20; i++){
    Serial.write(head[i]);
  }
}

void speech13(){//3
  unsigned char i = 0;
  unsigned char head[20];

  head[0] = 0xFD;
  head[1] = 0x00;
  head[2] = 0x11;
  head[3] = 0x01;
  head[4] = 0x00;
  head[5] = 0x5B;
  head[6] = 0x6D;
  head[7] = 0x34;
  head[8] = 0x5D;
  head[9] = 0x5B;
  head[10] = 0x76;
  head[11] = 0x35;
  head[12] = 0x5D;
  head[13] = 0x5B;
  head[14] = 0x74;
  head[15] = 0x35;
  head[16] = 0x5D;
  head[17] = 0xC8;
  head[18] = 0xFD;
  head[19] = 0x85;

  for(i=0; i<20; i++){
    Serial.write(head[i]);
  }
}



 
```
