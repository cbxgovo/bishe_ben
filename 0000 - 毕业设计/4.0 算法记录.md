

# 0316 å®‰è£…è¿‡ç¨‹è®°å½•
[ã€æ‰‹æŠŠæ‰‹å¸¦ä½ å®æˆ˜YOLOv5-å…¥é—¨ç¯‡ã€‘YOLOv5 ç¯å¢ƒå®‰è£…_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1G24y1G7qm/?buvid=XX7A39471D675D8F0A4AE55593F3A508A71AA&is_story_h5=false&mid=JrhLaIG%2F4%2FkK1riSfWjujQ%3D%3D&p=1&plat_id=114&share_from=ugc&share_medium=android&share_plat=android&share_session_id=3c6fc000-ea03-41ff-9e2b-af2144aff341&share_source=QQ&share_tag=s_i&timestamp=1678961472&unique_k=trjOr4r&up_id=21060026)


![[201903040009images.aasts/image-20230316144912132.png]]

![[201903040009images.aasts/image-20230316160849595.png]]
![[201903040009images.aasts/image-20230316164511005.png]]


![[201903040009images.aasts/image-20230316170305065.png]]

![[201903040009images.aasts/image-20230316170509898.png]]


![[201903040009images.aasts/image-20230316170626649.png]]

![[201903040009images.aasts/image-20230316171012299.png]]

![[201903040009images.aasts/image-20230316171016465.png]]

![[201903040009images.aasts/image-20230316171321149.png]]


![[201903040009images.aasts/image-20230316171330457.png]]

![[201903040009images.aasts/image-20230316171912849.png]]

è¿™æ ·ä¸‹çš„æ˜¯CPUç‰ˆæœ¬çš„ CPUè®­ç»ƒ

![[201903040009images.aasts/image-20230316172246052.png]]


![[201903040009images.aasts/image-20230316172353492.png]]

pip install -r requirements.txt


pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/


D:\b_installpath\miniconda3\

![[201903040009images.aasts/image-20230316182321684.png]]


![[201903040009images.aasts/image-20230316182618406.png]]

![[201903040009images.aasts/image-20230316182832142.png]]

## æ‘„åƒå¤´
K210 æ‘„åƒå¤´
![[201903040009images.aasts/image-20230313163257707.png]]
![[201903040009images.aasts/image-20230313195044100.png]]




## å®‰è£…torch 1.8.2 
![[201903040009images.aasts/image-20230317124514909.png]]



![[201903040009images.aasts/image-20230317111728871.png]]


![[201903040009images.aasts/image-20230317111724860.png]]

![[201903040009images.aasts/image-20230317111853184.png]]


![[201903040009images.aasts/image-20230317112510706.png]]

![[201903040009images.aasts/image-20230317112634147.png]]

![[201903040009images.aasts/image-20230317112701123.png]]

![[201903040009images.aasts/image-20230317112737837.png]]
![[201903040009images.aasts/image-20230317112750107.png]]

![[201903040009images.aasts/image-20230317112827885.png]]



## VSæ‰“å¼€è¿è¡Œ

![[201903040009images.aasts/image-20230317113758530.png]]

## å…³é”®å‚æ•° 
### weights
![[201903040009images.aasts/image-20230317114107820.png]]

`ç¬¬äºŒä¸ª ä¸€èˆ¬çš„ç‰ˆæœ¬`
python detect.py --weights yolov5s.pt  


![[201903040009images.aasts/image-20230317114017807.png]]

ç”¨é«˜çº§ç‰ˆæœ¬ æ˜æ˜¾é€Ÿåº¦å˜æ…¢äº†
![[201903040009images.aasts/image-20230317114244847.png]]

![[201903040009images.aasts/image-20230317114515393.png]]



---
### source
![[201903040009images.aasts/image-20230317114609209.png]]

python detect.py --weights yolov5s.pt --source data/images/bus.jpg

![[201903040009images.aasts/image-20230317114905608.png]]



![[201903040009images.aasts/image-20230317115139092.png]]
![[201903040009images.aasts/image-20230317115118826.png]]


### æ¡†çš„å¤šå°‘
0.8ç½®ä¿¡åº¦ä»¥ä¸Šçš„æ‰æ˜¾ç¤ºæ¡†
python detect.py --weights yolov5s.pt   --conf-thres 0.8

è¶Šä½æ¡†è¶Šå°‘
![[201903040009images.aasts/image-20230317120419452.png]]



è¶Šä½æ¡†è¶Šå¤š
![[201903040009images.aasts/image-20230317120937090.png]]



### åµŒå…¥å¾ˆéº»çƒ¦
![[201903040009images.aasts/image-20230317121144286.png]]


å…ˆå®‰è£…jupyter
pip install jupyterlab
![[201903040009images.aasts/image-20230317121548807.png]]


æ ¹ç›®å½•æ–°å»ºæ–‡ä»¶
hub_detect.ipynb
![[201903040009images.aasts/image-20230317121713962.png]]





```
import torch

# Model
model = torch. hub.1oad("./", "yolov5s", source= "local")

# Images
img = "./data/ images/ zidane.jpg"

#Inference
results = model(img)

# Results
results. show( )

```


![[201903040009images.aasts/image-20230317122145373.png]]



### gradioé¡µé¢
![[201903040009images.aasts/image-20230317150329706.png]]


### ipcam
[(3æ¡æ¶ˆæ¯) yolo-v5è¿æ¥æ‰‹æœºæ‘„åƒå¤´å®æ—¶æ£€æµ‹çš„æ­¥éª¤_æ€ä¹ˆæŠŠå®æ—¶å±å¹•ä¼ è¾“ç»™yolov5_ä¸–ç”±å¿ƒç”Ÿçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/gongkeguo/article/details/121609311)

[å‡ åˆ†é’Ÿå®ç°YOLO_V5ä»0åˆ°1è°ƒç”¨æ‰‹æœºæ‘„åƒå¤´å®æ—¶ç›®æ ‡æ£€æµ‹_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1kR4y147pR/?spm_id_from=333.337.search-card.all.click&vd_source=055c0f614d8dec2c3bf7aff0db5e54cb)

åœ°å€ä¸ºåˆ†äº«é‡Œé¢çš„å±€åŸŸç½‘åœ°å€

python detect.py --weights yolov5s.pt  

python detect.py --weights yolov5s.pt --source http://admin:admin@192.168.43.1:8081


python detect.py --source http://cbxg:cbxg@192.168.135.74:8081   
æœ¬æœºæ‘„åƒå¤´ï¼špython detect.py --source 0 

![[201903040009images.aasts/image-20230317160022837.png]]

![[201903040009images.aasts/image-20230317160103328.png]]





## YOLOç®—æ³•æ•°æ®é›†åˆ¶ä½œï¼šåˆ©ç”¨Pythonå°†è§†é¢‘åˆ‡åˆ†æˆå›¾ç‰‡

ç›®æ ‡æ£€æµ‹YOLOç®—æ³•æ•°æ®é›†åˆ¶ä½œï¼šåˆ©ç”¨Pythonå°†è§†é¢‘åˆ‡åˆ†æˆå›¾ç‰‡




# 0414 YOLO ä¸€äº›ä¿®æ”¹ç­–ç•¥ 0414åŠä¹‹å‰

## è¾“å‡ºçš„txt yolov5 labelæ ¼å¼è¯´æ˜

```python
cmd = r'd: && python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --source D:\Desktop\IOT_SoftWare\screenshot.jpg --save-txt'
```

![](201903040009images.aasts/image-20230415112739020.png)

5ä¸ªå€¼åˆ†åˆ«ä¸º ï¼š  
`æ ‡ç­¾ç¼–å·` `boxä¸­å¿ƒx` `boxä¸­å¿ƒy` `å®½` `é«˜`  
åˆ†åˆ«å¯¹åº”  
`label` `x_center` `y_center` `width` `height`  
labelå€¼ç”±è®­ç»ƒæ—¶è®¾å®š  
æ¯”å¦‚è®­ç»ƒæ—¶ä¸º`'Car', 'Cyclist', 'Pedestrian'`  
é‚£ä¹ˆ

```
0å¯¹åº”'Car'
1å¯¹åº”'Cyclist'
2å¯¹åº”'Pedestrian'`
```

å4ä¸ªå€¼éƒ½åœ¨0-1ä¹‹é—´ï¼Œåˆ†åˆ«ä¸ºboxä¸­å¿ƒçš„xã€boxä¸­å¿ƒçš„yã€å›¾åƒå®½ã€å›¾åƒé«˜ã€‚

```
            box_x_min # å·¦ä¸Šè§’æ¨ªåæ ‡ 
            box_y_min # å·¦ä¸Šè§’çºµåæ ‡
            box_x_max # å³ä¸‹è§’æ¨ªåæ ‡
            box_y_max # å³ä¸‹è§’çºµåæ ‡

            x_center = float(box_x_min + box_x_max) / (2 * picture_width)
            y_center = float(box_y_min + box_y_max) / (2 * picture_height)
            width = float(box_x_max - box_x_min) /  picture_width
            height = float(box_y_max - box_y_min) /  picture_height
```

## yolov5å®˜æ–¹æ ‡ç­¾å¯¹åº”å±æ€§æŒ‘é€‰  coco128.yamlğŸ‘

éšä¾¿æ‰“å¼€ä¸€ä¸ªè¾“å‡ºçš„txtæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸ª2è¡Œ5åˆ—çš„çŸ©é˜µï¼Œè¿™è¡¨æ˜æ£€æµ‹åˆ°äº†2ä¸ªç›®æ ‡ï¼Œæ¯ä¸€è¡Œè¡¨ç¤ºå¯¹åº”ç›®æ ‡çš„å±æ€§ï¼Œç¬¬ä¸€åˆ—æ˜¯æ ‡ç­¾åï¼ˆå°±æ˜¯è®­ç»ƒçš„æ—¶å€™çš„ç±»åˆ«æ ‡ç­¾åºå·ï¼Œè¿™é‡Œé‡‡ç”¨å®˜æ–¹çš„yolov5s.ptè¿›è¡Œæ£€æµ‹ï¼Œ<font color="#ffff00">0å¯¹åº”â€˜personâ€™</font>ï¼‰ï¼Œåé¢å››åˆ—ä¾æ¬¡ä¸ºxcenter ycenter w hï¼ˆæ¡†ä¸­å¿ƒçš„xã€yåæ ‡ï¼Œä»¥åŠæ¡†çš„å®½ã€é«˜ï¼‰ï¼Œå‡ä¸ºå½’ä¸€åŒ–æ•°å€¼ã€‚

åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/Albert_yeager/article/details/129767999

---

[[yolov5] yoloçš„æ•°æ®æ ‡ç­¾æ ¼å¼_yoloæ ¼å¼çš„æ ‡ç­¾_ä¸€éª‘çº¢å°˜è”ææ¥çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/condom10010/article/details/128164211)
![](201903040009images.aasts/image-20230415114445838.png)

`ç­›é€‰`
Â Â 0:Â äºº  Â 1:Â è‡ªè¡Œè½¦  Â 2:Â æ±½è½¦  Â 3:Â æ‘©æ‰˜è½¦  Â 5:Â å…¬å…±æ±½è½¦  Â 9:Â äº¤é€šç¯  13:Â é•¿æ¤…  Â 16:Â ç‹—
Â 
---

  0: äºº
  1: è‡ªè¡Œè½¦
  2: æ±½è½¦
  3: æ‘©æ‰˜è½¦
  4: é£æœº
  5: å…¬å…±æ±½è½¦
  6: ç«è½¦
  7: å¡è½¦
  8: èˆ¹åª
  9: äº¤é€šç¯
  10: æ¶ˆé˜²æ “
  11: åœè½¦æ ‡å¿—
  12: åœè½¦è®¡æ—¶å™¨
  13: é•¿æ¤…
  14: é¸Ÿ
  15: çŒ«
  16: ç‹—
  17: é©¬
  18: ç»µç¾Š
  19: ç‰›
  20: å¤§è±¡
  21: ç†Š
  22: æ–‘é©¬
  23: é•¿é¢ˆé¹¿
  24: èƒŒåŒ…
  25: é›¨ä¼
  26: æ‰‹æåŒ…
  27: é¢†å¸¦
  28: æ‰‹æç®±
  29: é£ç›˜
  30: æ»‘é›ªæ¿
  31: æ»‘é›ªæ¿
  32: è¿åŠ¨çƒ
  33: é£ç­
  34: æ£’çƒæ£’
  35: æ£’çƒæ‰‹å¥—
  36: æ»‘æ¿
  37: å†²æµªæ¿
  38: ç½‘çƒæ‹
  39: é…’ç“¶
  40: é…’æ¯
  41: æ¯å­
  42: å‰å­
  43: åˆ€
  44: å‹ºå­
  45: ç¢—
  46: é¦™è•‰
  47: è‹¹æœ
  48: ä¸‰æ˜æ²»
  49: æ©™å­
  50: è¥¿å…°èŠ±
  51: èƒ¡èåœ
  52: çƒ­ç‹—
  53: æŠ«è¨
  54: ç”œç”œåœˆ
  55: è›‹ç³•
  56: æ¤…å­
  57: æ²™å‘
  58: ç›†æ ½
  59: åºŠ
  60: é¤æ¡Œ
  61: å•æ‰€
  62: ç”µè§†æœº
  63: ç¬”è®°æœ¬ç”µè„‘
  64: é¼ æ ‡
  65: é¥æ§å™¨
  66: é”®ç›˜
  67: æ‰‹æœº
  68: å¾®æ³¢ç‚‰
  69: çƒ¤ç®±
  70: çƒ¤é¢åŒ…æœº
  71: æ°´æ§½
  72: å†°ç®±
  73: ä¹¦
  74: é’Ÿè¡¨
  75: èŠ±ç“¶
  76: å‰ªåˆ€
  77: æ³°è¿ªç†Š
  78: å¹é£æœº
  79: ç‰™åˆ·










## txtæ–‡ä»¶é»˜è®¤æ˜¯ç´¯ç§¯å¾€ä¸‹çš„ ä¿®æ”¹ ğŸ‘ğŸ‘ 
---
updated: 2023-04-15 12:37

æˆ‘è¿™é‡ŒåŠ ä¸Šäº† --exist-ok ç¡®ä¿äº†æ¯æ¬¡è¯†åˆ«å‡ºæ¥çš„å›¾ç‰‡ä¼šè¿›è¡Œè¦†ç›–ï¼Œä½†labelçš„txtæ–‡ä»¶ä¸ä¼šè¦†ç›–ï¼Œtxtä¼šç´¯è®¡å¾€ä¸‹å†™
å› æ­¤éœ€è¦å¯¹æºç è¿›è¡Œä¿®æ”¹

```
python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --source data/images/bus.jpg --save-txt  --class 0 2 3  --exist-ok
```


```
python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --source D:\Desktop\IOT_SoftWare\screenshot.jpg --save-txt --class 0 2 3  --exist-ok
```

`æœ€ç»ˆçš„`
```
python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --source D:\Desktop\IOT_SoftWare\screenshot.jpg --save-txt --class 0 1 2 3 5 9 13 16  --exist-ok
```

![](201903040009images.aasts/image-20230415121024129.png)

ä¿®æ”¹yoloæºä»£ç ï¼š
[yolov5 --save-txt ç”Ÿæˆçš„txtæ€ä¹ˆè®¾ç½®ä¸ºè¦†ç›–è€Œä¸æ˜¯è¿½åŠ åˆ°txtä¸­ï¼Ÿ-ç¼–ç¨‹è¯­è¨€-CSDNé—®ç­”](https://ask.csdn.net/questions/7766446)

detect.pyå‡½æ•°çš„ 160-166 åŸæ¥çš„aä¸”åœ¨forå¾ªç¯ä¹‹å†…

```
                # Write results
                for *xyxy, conf, cls in reversed(det):
                    if save_txt:  # Write to file
                        xywh = (xyxy2xywh(torch.tensor(xyxy).view(1, 4)) / gn).view(-1).tolist()  # normalized xywh
                        line = (cls, *xywh, conf) if save_conf else (cls, *xywh)  # label format
                        with open(f'{txt_path}.txt', 'w') as f: # txtè¾“å‡ºæ–‡ä»¶ aæ˜¯è¿½åŠ å†™ï¼Œwæ˜¯è¦†ç›–å†™
                            f.write(('%g ' * len(line)).rstrip() % line + '\n')
```

![](201903040009images.aasts/image-20230415121644819.png)



----
ä¿®æ”¹å
![](201903040009images.aasts/image-20230415122511065.png)

160-167è¡Œ
```
                # Write results
            with open(f'{txt_path}.txt', 'w') as f: # txtè¾“å‡ºæ–‡ä»¶ aæ˜¯è¿½åŠ å†™ï¼Œwæ˜¯è¦†ç›–å†™
                for *xyxy, conf, cls in reversed(det):
                    if save_txt:  # Write to file
                        xywh = (xyxy2xywh(torch.tensor(xyxy).view(1, 4)) / gn).view(-1).tolist()  # normalized xywh
                        line = (cls, *xywh, conf) if save_conf else (cls, *xywh)  # label format
                        
                        f.write(('%g ' * len(line)).rstrip() % line + '\n')
```

è¿è¡Œç»“æœï¼šæ”¹å®Œä¹‹åä¸è®ºå›¾ç‰‡è¿˜æ˜¯txtéƒ½æ˜¯ä¼šè¦†ç›–çš„
![](201903040009images.aasts/image-20230415123004677.png)


æ¢å›¾ç‰‡ä¹‹åä¹Ÿä¼šè‡ªåŠ¨è¦†ç›–ï¼š
![](201903040009images.aasts/image-20230415123218254.png)

![](201903040009images.aasts/image-20230415123227980.png)




---
æ•´ä½“æµç¨‹è®°å½•

`yolov5 --save-txt ç”Ÿæˆçš„txtæ€ä¹ˆè®¾ç½®ä¸ºè¦†ç›–è€Œä¸æ˜¯è¿½åŠ åˆ°txtä¸­ï¼Ÿ`
ç”¨yolov5 detect.pyè¿›è¡Œè®­ç»ƒæ•°æ®æ—¶ï¼Œéœ€è¦å®æ—¶å¯¹ä¼ å…¥çš„ç›¸åŒåå­—çš„å›¾ç‰‡è¿›è¡Œè®­ç»ƒï¼Œ
è¯·é—®å½“--save-txtå‚æ•°ä¸ºTrueæ—¶ï¼Œå¦‚æœç…§ç‰‡åç›¸åŒï¼Œæ¯æ¬¡æ–°çš„åæ ‡æ•°æ®éƒ½æ˜¯è¿½åŠ åˆ°åŸæ¥ç”Ÿæˆçš„txtä¸­
å¯¼è‡´è¯»å–æ­¤æ–‡æœ¬æ—¶ï¼Œå­˜åœ¨ä¸Šæ¬¡è®­ç»ƒæ—¶çš„æ—§çš„æ•°æ®ã€‚
æˆ‘è®¾ç½®äº†--exist-okä¸ºTrueï¼Œæ¯æ¬¡è¯†åˆ«å‡ºæ¥çš„å›¾ç‰‡ä¼šè¿›è¡Œè¦†ç›–ï¼Œä½†labelçš„txtæ–‡ä»¶ä¸ä¼šè¦†ç›–ï¼Œ
æ€ä¹ˆæ ·æ‰èƒ½è®¾ç½®æ¯æ¬¡ç”Ÿæˆçš„txtæ˜¯è¦†ç›–åŸæ¥çš„å‘¢ï¼Ÿ

ç­”ï¼šæœç´¢ä¸‹txt\_path,ç„¶åå°†è¿™é‡Œçš„aæ¢æˆwï¼Œaæ˜¯è¿½åŠ å†™ï¼Œwæ˜¯è¦†ç›–å†™
![img](1681532835.assets/1681532835-abe63461130746acfd8d8fc53662e52d.png)

é—®ï¼šè¯·é—®æ¢æˆwçš„è¯ï¼Œå¦‚æœä¸€å¼ å›¾ç‰‡æœ‰å¤šä¸ªç‰¹å¾å€¼çš„è¯ï¼Œç”Ÿæˆçš„txté‡Œåªä¼šè®°å½•æœ€åä¸€ä¸ªï¼Œæœ‰æ²¡æœ‰åŠæ³•ä½¿å¾—å°†ä¸€å¼ å›¾ç‰‡é‡Œæ‰€æœ‰æ ‡ç­¾éƒ½å†™å…¥txtåå†è¯†åˆ«ä¸‹ä¸€å¼ å›¾ç‰‡æ—¶è¦†ç›–æ‰åŸæ¥çš„å‘¢
   
ç­”ï¼šæŠŠè¿™å¥æåˆ°forå¾ªç¯å¤–é¢å»å•Š

å¤ªæ„Ÿè°¢å¤§ä½¬äº†ï¼(ã£'-')â•®=ÍŸÍŸÍÍ






## åªé¢„æµ‹æŒ‡å®šç±»åˆ«

```
--save-txt            save results to *.txt    #å°†é¢„æµ‹çš„bounding boxä¿å­˜ä¸ºtxtæ–‡ä»¶
--save-crop           save cropped prediction boxes   #å°†é¢„æµ‹çš„bounding boxæˆªå–å‡ºæ¥
 --classes CLASSES [CLASSES ...]    #åªé¢„æµ‹æŒ‡å®šç±»åˆ«
 
 classes=None, Â # filter by class: --class 0, or --class 0 2 3
```



```
cmd = r'd: && python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --source D:\Desktop\IOT_SoftWare\screenshot.jpg --save-txt  --class 0 2 3 '
```



## yoloå°†è¿”å›å€¼resultså†™å…¥txt 


# 0415 èåˆæˆªå›¾ cmd txtè¾“å‡ºæµ‹è¯• é‡å¤§çªç ´ğŸ˜
---
updated: 2023-04-15 

## æµ‹è¯•æˆªå›¾

![](201903040009images.aasts/image-20230415185540231.png)


ä»¥æŠ“å–wpsæ‰“å¼€çš„å›¾ç‰‡çª—å£ä¸ºä¾‹
![](201903040009images.aasts/image-20230415185824704.png)

![](201903040009images.aasts/image-20230415185903976.png)

![](201903040009images.aasts/image-20230415185922313.png)

## ä»£ç ä¿å­˜
![](201903040009images.aasts/image-20230416231544729.png)


```python
# èåˆæŠ“å›¾ è¯†åˆ« è¾“å‡ºè¯†åˆ«ä¿¡æ¯ä¸‰ä¸ªéƒ¨åˆ†
# 2023.04.15 created by å¾æ¢¦æ˜Š
# -*- coding: UTF-8 -*-
# cmdä¾èµ–
import os, sys, re

# æˆªå›¾æŒ‡å®šhwndçš„çª—å£ å¹¶æˆªå›¾ä¿å­˜
# å…ˆå¼•å…¥ä¾èµ–åŒ… pip install PyQt5
# æœ€å¼€å§‹è¿è¡Œçš„æ—¶å€™å…ˆæ³¨é‡Šæ‰ä¸‹é¢çš„hwnd ä»¥ä¸‹çš„ç¨‹åº å› ä¸ºhwndæˆ‘è¦å…ˆè·‘ä¸Šé¢çš„ç¨‹åºè·å– å¯ä»¥å…ˆæ”¾å¼€ä¸‹ä¸€è¡Œhwndä¸‡é‡‘æ²¹è¿è¡Œä¸€é è¿™æ ·ä¸ç”¨æ³¨é‡Š
# æˆªå›¾ä¾èµ–
import win32gui
import win32con
from PyQt5.QtWidgets import QApplication
from PIL import ImageGrab


# æŠ“å–æŒ‡å®šçš„çª—å£ æˆªå±ä¿å­˜
def screenshot_f():
    # hwnd_title = dict()

    # def get_all_hwnd(hwnd, mouse):
    #     if win32gui.IsWindow(hwnd) and win32gui.IsWindowEnabled(hwnd) and win32gui.IsWindowVisible(hwnd):
    #         hwnd_title.update({hwnd: win32gui.GetWindowText(hwnd)})

    
    # win32gui.EnumWindows(get_all_hwnd, 0)
    # # print(hwnd_title.items()) æ‰“å°çš„æ˜¯hwndå€¼å’Œå¯¹åº”çš„Title
    # for h, t in hwnd_title.items():
    #     if t != "":
    #         print(h, t)
    

    hwnd = 133042 #  ä¸Šé¢è·å–åè‡ªå·±å¡«å…¥å¯¹åº”çª—å£çš„hwnd ç¬¬ä¸€åˆ—
    print(hwnd)

    win32gui.ShowWindow(hwnd, win32con.SW_RESTORE)  # å¼ºè¡Œæ˜¾ç¤ºç•Œé¢åæ‰å¥½æˆªå›¾
    win32gui.SetForegroundWindow(hwnd)  # å°†çª—å£æåˆ°æœ€å‰
    #  è£å‰ªå¾—åˆ°å…¨å›¾
    game_rect = win32gui.GetWindowRect(hwnd)
    src_image = ImageGrab.grab(game_rect)
    # src_image.show() #æˆªå›¾å®Œç”¨ç³»ç»Ÿé»˜è®¤å›¾ç‰‡æŸ¥çœ‹å™¨æ‰“å¼€ å¯ä»¥ä¸æ‰“å¼€
    src_image.save("screenshot.jpg")


# yolo çš„cmdè°ƒç”¨ ç”Ÿæˆè¦†ç›–çš„txtæ–‡æœ¬æ–‡ä»¶
def getcmd_f():
	'''
	å¤„ç†å›¾ç‰‡
	:param url:å›¾ç‰‡åœ°å€
	:return: å›¾ç‰‡ä¸­çš„äººæ•°
	'''
	cmd = r'd: && python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --conf-thres 0.6 --source D:\Desktop\IOT_SoftWare\screenshot.jpg --save-txt --class 0 1 2 3 5 9 13 16  --exist-ok'
	text = os.popen(cmd).readlines()
	print(text)


def txt_spilt_f():
    f=open("D:/Desktop/yolov5-7.0/runs/detect/exp/labels/screenshot.txt","r", encoding = 'utf-8',errors='ignore')
    txt = [0,0,0,0,0,0,0,0]
    for line in f:
        # print(line.split(' ')[0]) # ä¸€æ­¥åˆ°ä½
        # a = line.split(' ')[0] # aä¸ºä»¥ç©ºæ ¼åˆ†éš”ä¹‹åçš„é¦–ä¸ªå…ƒç´   ä»ä¸ºå­—ç¬¦ç±»å‹
        a = int(line.split(' ')[0]) # aä¸ºä»¥ç©ºæ ¼åˆ†éš”ä¹‹åçš„é¦–ä¸ªå…ƒç´  
        # print(a)
        if a == 0:# äºº
            txt[0] = txt[0] +1
        if a == 1: # è‡ªè¡Œè½¦
            txt[1] = txt[1] +1
        if a == 2: # æ±½è½¦
            txt[2] = txt[2] +1
        if a == 3: # æ‘©æ‰˜è½¦
            txt[3] = txt[3] +1
        if a == 5: # å…¬å…±æ±½è½¦
            txt[4] = txt[4] +1
        if a == 9: # äº¤é€šç¯
            txt[5] = txt[5] +1
        if a == 13: # é•¿æ¤…
            txt[6] = txt[6] +1
        if a == 16: # ç‹—
            txt[7] = txt[7] +1

    message = ""
    if txt[0] != 0:# äºº
        message = str(txt[0]) +"ä¸ªäºº "
    if txt[1] != 0: # è‡ªè¡Œè½¦
        message = message +  str(txt[1]) +"è¾†è‡ªè¡Œè½¦ "
    if txt[2] != 0: # æ±½è½¦
        message = message +  str(txt[2]) +"è¾†æ±½è½¦ "
    if txt[3] != 0: # æ‘©æ‰˜è½¦
        message = message +  str(txt[3]) +"è¾†æ‘©æ‰˜è½¦ "
    if txt[4] != 0: # å…¬å…±æ±½è½¦
        message = message +  str(txt[4]) +"è¾†å…¬å…±æ±½è½¦ "
    if txt[5] != 0: # äº¤é€šç¯
        message = message +  str(txt[5]) +"ä¸ªäº¤é€šç¯ "
    if txt[6] != 0: # é•¿æ¤…
        message = message +  str(txt[6]) +"ä¸ªé•¿æ¤… "
    if txt[7] != 0: # ç‹—
        message = message +  str(txt[7]) +"æ¡ç‹— "
    message1 = "å‰æ–¹å…±æœ‰"+ message
    print (message1)

	

if __name__ == '__main__':
    screenshot_f()
    getcmd_f()
    txt_spilt_f()
```



# 0416 èåˆæ¥å—ä¿¡æ¯ å‘å¸ƒè¯†åˆ«çŠ¶å†µ é‡å¤§çªç ´ğŸ˜
---
updated: 2023-04-16 18:01

èåˆåæ¥è¿é‡åˆ°ä¸¤ä¸ªé—®é¢˜
## error(0, â€˜SetForegroundWindowâ€˜, â€˜No error message is availableâ€˜)
[error(0, â€˜SetForegroundWindowâ€˜, â€˜No error message is availableâ€˜)_reb0rnåˆä»£çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/qq_34195441/article/details/109177402)

åŸæ¥ä»£ç å‡ºç°error(0, 'SetForegroundWindow', 'No error message is available')é”™è¯¯ï¼Œ

è§£å†³æ–¹æ³•ï¼šåŠ ä¸Š


```python
pythoncom.CoInitialize()
shell = win32com.client.Dispatch("WScript.Shell")
shell.SendKeys('%')
```


åŸæ–‡é“¾æ¥ï¼šhttps://blog.csdn.net/qq_34195441/article/details/109177402
![](201903040009images.aasts/image-20230416175812750.png)

## åŠ å…¥ä¸Šè¿°ä¸‰å¥åno module named win32com.client æŠ¥é”™

[no module named win32com.client æŠ¥é”™ - å¯çˆ±çš„é»‘ç²¾çµ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/chenjy1225/p/14461819.html)
![](201903040009images.aasts/image-20230416175926332.png)
ä¿®æ”¹å¼•å…¥çš„ä¾èµ–
![](201903040009images.aasts/image-20230416180006246.png)

## æœ€åå®ç°çš„æ•ˆæœ  æ¼”ç¤º
1. è¿è¡Œä»£ç 
![](201903040009images.aasts/image-20230416180623730.png)

2. å·²ç»è®¢é˜… ä¸”æŒç»­ç›‘å¬å½“ä¸­
![](201903040009images.aasts/image-20230416180700289.png)

3. mqtt.fxæ¨¡æ‹ŸæŒ‰é”®æŒ‰ä¸‹ å‘é€æ¶ˆæ¯å­—ç¬¦â€œ1â€
![](201903040009images.aasts/image-20230416180733582.png)

4. pythonæ§åˆ¶å°æ˜¾ç¤ºè¯†åˆ«ç»“æœ 
![](201903040009images.aasts/image-20230416180816004.png)

5. yoloé¡¹ç›®ä¸­è¾“å‡ºçš„å›¾ç‰‡å’Œtxtå‡å·²ç»è¦†ç›–æ›´æ–°
![](201903040009images.aasts/image-20230416180901857.png)

6. mqttfxæ¨¡æ‹Ÿæ¥æ”¶çš„å›¾åƒè¯†åˆ«ä¿¡æ¯ å·²ç»æ­£ç¡®æ”¶åˆ°
![](201903040009images.aasts/image-20230416180951065.png)

7. ä¸‹ä¸€æ­¥å°†è¦åšçš„
   ä¸»æ¿è®¢é˜…è¯¥æ¥æ”¶è¯†åˆ«ä¿¡æ¯çš„ä¸»é¢˜
   ä¸»æ¿è¿æ¥è¯­éŸ³æ¨¡å—å¯¹è¯¥ä¿¡æ¯è¿›è¡Œæ’­æŠ¥ã€å¾…åš ä¸‹ä¸€æ­¥ã€‘
   æœ€ç»ˆå®ç° æˆ‘æŒ‰ä¸‹ä¸»æ¿çš„æŒ‰é’® å°±æ’­æ”¾æˆ‘çœ¼å‰æ™¯è±¡çš„å›¾åƒè¯†åˆ«ä¿¡æ¯



## æœåŠ¡å™¨æºç 
![](201903040009images.aasts/image-20230416231632936.png)


ä¸»è¦åŠŸèƒ½ï¼š
1. è®¢é˜…ä¸»æ¿æŒ‰é”®å¯¹åº”çš„ä¸»é¢˜
2. ç›‘å¬æŒ‰é”®æŒ‰ä¸‹ æ¨¡æ‹Ÿå‘é€åˆ°è¯¥ä¸»é¢˜å­—ç¬¦â€œ1â€
3. ç›‘å¬åˆ°ä¹‹åï¼Œæ¥è¿è°ƒç”¨ æŠ“å± ã€yoloè¯†åˆ«ã€è¾“å‡ºtxtæ–‡æœ¬çš„è¯†åˆ«
4. å°†è¯†åˆ«å¤„ç†ä¹‹åçš„ç»“æœå­—ç¬¦ä¸²å‘é€åˆ°æŒ‡å®šçš„ä¸»é¢˜ï¼ˆè¯¥ä¸»é¢˜ç”¨äº ä¸»æ¿æ¥æ”¶åˆ°ä¹‹åè¿›è¡Œè¯­éŸ³æ’­æŠ¥ <font color="#ffff00">å¾…å®ç°è¯­éŸ³</font>ï¼‰
```python
# python3.6
# -*- coding: utf-8 -*-
import paho.mqtt.client as mqtt
import random

# -*- coding: UTF-8 -*-
# cmdä¾èµ–
import os, sys, re

# æˆªå›¾æŒ‡å®šhwndçš„çª—å£ å¹¶æˆªå›¾ä¿å­˜
# å…ˆå¼•å…¥ä¾èµ–åŒ… pip install PyQt5
# æœ€å¼€å§‹è¿è¡Œçš„æ—¶å€™å…ˆæ³¨é‡Šæ‰ä¸‹é¢çš„hwnd ä»¥ä¸‹çš„ç¨‹åº å› ä¸ºhwndæˆ‘è¦å…ˆè·‘ä¸Šé¢çš„ç¨‹åºè·å– å¯ä»¥å…ˆæ”¾å¼€ä¸‹ä¸€è¡Œhwndä¸‡é‡‘æ²¹è¿è¡Œä¸€é è¿™æ ·ä¸ç”¨æ³¨é‡Š
# æˆªå›¾ä¾èµ–
import win32gui
import win32con
from PyQt5.QtWidgets import QApplication
from PIL import ImageGrab

# import win32com
import win32com.client
import pythoncom


broker = 'broker.emqx.io'
port = 1883
topic_button = "cc36e70148924ef2bb2e1d477c24675f_button"
topic_mp3 = "cc36e70148924ef2bb2e1d477c24675f_mp3"
# generate client ID with pub prefix randomly
client_id = f'python-mqtt-{random.randint(0, 100)}'


# è®¢é˜…å‡½æ•°
class MqttRoad(object):
 
    def __init__(self, mqtt_host, mqtt_port, mqtt_keepalive):
        super(MqttRoad, self).__init__()
        client = mqtt.Client()
        client.on_connect = self.on_connect
        client.on_message = self.on_message
        client.on_publish = self.on_publish
        client.connect(mqtt_host, mqtt_port, mqtt_keepalive)  # 600ä¸ºkeepaliveçš„æ—¶é—´é—´éš”
        client.loop_forever()  # ä¿æŒè¿æ¥
 
    def on_connect(self, client, userdata, flags, rc):
        print("Connected with result code: " + str(rc))
        # è®¢é˜…
        client.subscribe(topic_button)
 
 
    def on_message(self, client, userdata, msg):
        print("on_message topic:" + msg.topic + " message:" + str(msg.payload.decode('utf-8')))
        strmqtt = str(msg.payload.decode('utf-8'))
        if strmqtt == "1":
            print("æ¥æ”¶åˆ°æŒ‰é”®è¯·æ±‚ è¯·æ±‚å‘å¸ƒç”»é¢è¯†åˆ«çš„è¯­éŸ³æ’­æŠ¥")
            screenshot_f()
            print("tag1")
            getcmd_f()
            print("tag2")
            txt_spilt_f()
            print("tag3")
            publish()
            print("tag4")
        else:
            print("æœªæ”¶åˆ°æ­£ç¡®æŒ‰é”®è¯·æ±‚ å ç©ºç”¨")
        
 
    #   è®¢é˜…å›è°ƒ
    def on_subscribe(self, client, userdata, mid, granted_qos):
        print("On Subscribed: qos = %d" % granted_qos)
        pass
 
    #   å–æ¶ˆè®¢é˜…å›è°ƒ
    def on_unsubscribe(self, client, userdata, mid):
        # print("å–æ¶ˆè®¢é˜…")
        print("On unSubscribed: qos = %d" % mid)
        pass
 
    #   å‘å¸ƒæ¶ˆæ¯å›è°ƒ
    def on_publish(self, client, userdata, mid):
        # print("å‘å¸ƒæ¶ˆæ¯")
        print("On onPublish: qos = %d" % mid)
        pass
 
    #   æ–­å¼€é“¾æ¥å›è°ƒ
    def on_disconnect(self, client, userdata, rc):
        # print("æ–­å¼€é“¾æ¥")
        print("Unexpected disconnection rc = " + str(rc))
        pass
 
# å‘å¸ƒå‡½æ•°
def publish():
    def on_connect(client, userdata, flags, rc):
        print ("é“¾æ¥")
        print("Connected with result code: " + str(rc))
    
    
    def on_message(client, userdata, msg):
        print ("æ¶ˆæ¯å†…å®¹")
        print(msg.topic + " " + str(msg.payload))
    
    
    #   è®¢é˜…å›è°ƒ
    def on_subscribe(client, userdata, mid, granted_qos):
        print ("è®¢é˜…")
        print("On Subscribed: qos = %d" % granted_qos)
        pass
    
    
    #   å–æ¶ˆè®¢é˜…å›è°ƒ
    def on_unsubscribe(client, userdata, mid, granted_qos):
        print ("å–æ¶ˆè®¢é˜…")
        print("On unSubscribed: qos = %d" % granted_qos)
        pass
    
    
    #   å‘å¸ƒæ¶ˆæ¯å›è°ƒ
    def on_publish(client, userdata, mid):
        print ("å‘å¸ƒæ¶ˆæ¯")
        print("On onPublish: qos = %d" % mid)
        pass
    
    
    #   æ–­å¼€é“¾æ¥å›è°ƒ
    def on_disconnect(client, userdata, rc):
        print ("æ–­å¼€é“¾æ¥")
        print("Unexpected disconnection rc = " + str(rc))
        pass
    
    
    client = mqtt.Client()
    client.on_connect = on_connect
    client.on_message = on_message
    client.on_publish = on_publish
    client.on_disconnect = on_disconnect
    client.on_unsubscribe = on_unsubscribe
    client.on_subscribe = on_subscribe
    client.connect(broker, 1883, 600) # 600ä¸ºkeepaliveçš„æ—¶é—´é—´éš”

    # client.publish(topic_mp3, payload='å‰æ–¹å…±æœ‰1ä¸ªäºº 3è¾†æ±½è½¦ 1æ¡ç‹— ', qos=0, retain=False)
    client.publish(topic_mp3, payload = message1, qos=0, retain=False)
    


# æŠ“å–æŒ‡å®šçš„çª—å£ æˆªå±ä¿å­˜
def screenshot_f():

    hwnd = 133042 #  ä¸Šé¢è·å–åè‡ªå·±å¡«å…¥å¯¹åº”çª—å£çš„hwnd ç¬¬ä¸€åˆ—
    print(hwnd)

    win32gui.ShowWindow(hwnd, win32con.SW_RESTORE)  # å¼ºè¡Œæ˜¾ç¤ºç•Œé¢åæ‰å¥½æˆªå›¾
    # èåˆååŠ å…¥ä»¥ä¸‹ä¸‰è¡Œæ‰è¡Œçš„
    pythoncom.CoInitialize()
    shell = win32com.client.Dispatch("WScript.Shell")
    shell.SendKeys('%')
    win32gui.SetForegroundWindow(hwnd)  # å°†çª—å£æåˆ°æœ€å‰
    #  è£å‰ªå¾—åˆ°å…¨å›¾
    game_rect = win32gui.GetWindowRect(hwnd)
    src_image = ImageGrab.grab(game_rect)
    # src_image.show() #æˆªå›¾å®Œç”¨ç³»ç»Ÿé»˜è®¤å›¾ç‰‡æŸ¥çœ‹å™¨æ‰“å¼€ å¯ä»¥ä¸æ‰“å¼€
    src_image.save("screenshot.jpg")


# yolo çš„cmdè°ƒç”¨ ç”Ÿæˆè¦†ç›–çš„txtæ–‡æœ¬æ–‡ä»¶
def getcmd_f():
	'''
	å¤„ç†å›¾ç‰‡
	:param url:å›¾ç‰‡åœ°å€
	:return: å›¾ç‰‡ä¸­çš„äººæ•°
	'''
	cmd = r'd: && python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --conf-thres 0.6 --source D:\Desktop\IOT_SoftWare\screenshot.jpg --save-txt --class 0 1 2 3 5 9 13 16  --exist-ok'
	text = os.popen(cmd).readlines()
	print(text)

# txtæ–‡æœ¬ä¿¡æ¯å¤„ç†
def txt_spilt_f():
    f=open("D:/Desktop/yolov5-7.0/runs/detect/exp/labels/screenshot.txt","r", encoding = 'utf-8',errors='ignore')
    txt = [0,0,0,0,0,0,0,0]
    for line in f:
        # print(line.split(' ')[0]) # ä¸€æ­¥åˆ°ä½
        # a = line.split(' ')[0] # aä¸ºä»¥ç©ºæ ¼åˆ†éš”ä¹‹åçš„é¦–ä¸ªå…ƒç´   ä»ä¸ºå­—ç¬¦ç±»å‹
        a = int(line.split(' ')[0]) # aä¸ºä»¥ç©ºæ ¼åˆ†éš”ä¹‹åçš„é¦–ä¸ªå…ƒç´  
        # print(a)
        if a == 0:# äºº
            txt[0] = txt[0] +1
        if a == 1: # è‡ªè¡Œè½¦
            txt[1] = txt[1] +1
        if a == 2: # æ±½è½¦
            txt[2] = txt[2] +1
        if a == 3: # æ‘©æ‰˜è½¦
            txt[3] = txt[3] +1
        if a == 5: # å…¬å…±æ±½è½¦
            txt[4] = txt[4] +1
        if a == 9: # äº¤é€šç¯
            txt[5] = txt[5] +1
        if a == 13: # é•¿æ¤…
            txt[6] = txt[6] +1
        if a == 16: # ç‹—
            txt[7] = txt[7] +1

    message = ""
    if txt[0] != 0:# äºº
        message = str(txt[0]) +"ä¸ªäºº "
    if txt[1] != 0: # è‡ªè¡Œè½¦
        message = message +  str(txt[1]) +"è¾†è‡ªè¡Œè½¦ "
    if txt[2] != 0: # æ±½è½¦
        message = message +  str(txt[2]) +"è¾†æ±½è½¦ "
    if txt[3] != 0: # æ‘©æ‰˜è½¦
        message = message +  str(txt[3]) +"è¾†æ‘©æ‰˜è½¦ "
    if txt[4] != 0: # å…¬å…±æ±½è½¦
        message = message +  str(txt[4]) +"è¾†å…¬å…±æ±½è½¦ "
    if txt[5] != 0: # äº¤é€šç¯
        message = message +  str(txt[5]) +"ä¸ªäº¤é€šç¯ "
    if txt[6] != 0: # é•¿æ¤…
        message = message +  str(txt[6]) +"ä¸ªé•¿æ¤… "
    if txt[7] != 0: # ç‹—
        message = message +  str(txt[7]) +"æ¡ç‹— "
    global message1 
    message1= "å‰æ–¹å…±æœ‰"+ message
    print (message1)

 
if __name__ == '__main__':
    MqttRoad(broker, 1883, 600)

```


# 0416 ç¡¬ä»¶æŒ‰é”®è§¦å‘ç®—æ³•æ£€æµ‹ æ”¶åˆ°å‘å¸ƒçš„æ£€æµ‹ç»“æœ ğŸ˜ è¿˜å·®è¯­éŸ³æ’­æŠ¥
## æµ‹è¯•ç»“æœæˆªå›¾
![](201903040009images.aasts/image-20230416222212967.jpeg)


![](201903040009images.aasts/image-20230416222219463.jpeg)

![](201903040009images.aasts/image-20230416222225037.jpeg)
![](201903040009images.aasts/image-20230416225540752.png)

![](201903040009images.aasts/image-20230416225905079.png)


## å®Œæ•´æµç¨‹ æ¼”ç¤º
1. æŒ‰ä¸‹æŒ‰é”® åœ¨è¿™é‡Œä»¥æœé‚¦çº¿çŸ­æ¥åœ°ä¸ºæ¨¡æ‹Ÿ ç„¶åæ¾å¼€ å¼€å‘æ¿æ£€æµ‹åˆ°ä¼šå‘é€ä¸€ä¸ªç‰¹å®šçš„å­—ç¬¦ä¸²â€1â€œåˆ°ä¸»é¢˜
![](201903040009images.aasts/image-20230416224551266.png)
2. å¼€å‘æ¿çš„ä¸²å£æ˜¾ç¤º 

![](201903040009images.aasts/image-20230416224439526.png)

3. pythonåå°æ£€æµ‹åˆ°æŒ‡å®šå­—ç¬¦ä¸²ä¹‹å è°ƒç”¨ä¸€è¿ä¸²æˆ‘å†™å¥½çš„æ–¹æ³• å°†æ£€æµ‹çš„æœ€ç»ˆç»“æœå‘å¸ƒå‡ºå»
![](201903040009images.aasts/image-20230416224738987.png)


4. å¼€å‘æ¿çš„ä¸€ç«¯æ¥æ”¶åˆ°ä¸»é¢˜å‘æ¥çš„æ¶ˆæ¯ æ”¶åˆ°æ£€æµ‹ç»“æœ
![](201903040009images.aasts/image-20230416224759545.png)
## ç¡¬ä»¶ä»£ç 

```c
#include <ESP8266WiFi.h>
#include <PubSubClient.h>
#include "Timer.h"
//#include <SimpleDHT.h> //æ¸©æ¹¿åº¦
#include "pinMapping.h" //å¼•è„šå®šä¹‰ ç›´æ¥å¼•ç”¨Dx
WiFiClient espClient;
PubSubClient client(espClient);
Timer t;

// WiFi 
const char* ssid = "cbxg";
const char* password = "12345678";

// MQTT Broker
const char *mqtt_broker = "broker.emqx.io";
const char *topic1 = "cc36e70148924ef2bb2e1d477c24675f_mp3";//ç»ˆç«¯æ”¶ æ•ˆåº”å™¨ä»è¯¥ä¸»é¢˜æ¥æ”¶æŒ‡ä»¤ æ¥æ”¶è¯†åˆ«ä¿¡æ¯
const char *topic2 = "cc36e70148924ef2bb2e1d477c24675f_button";//ç»ˆç«¯å‘ æŒ‰é”®ä¹‹åå‘é€1
const char *mqtt_username = "root";
const char *mqtt_password = "root0410";
const int mqtt_port = 1883;

//// è¶…å£°æ³¢ å››ä¸ªå¼•è„š D2 D1 GND 3V3
//// define ultrasonic signal receiver pin  ECHO to D2  GPIO4
//int ECHOPin = D2;  
//// define ultrasonic signal transmitter pin  TRIG to D1  GPIO5
//int TRIGPin = D1;  

//ä¼ æ„Ÿå™¨æ”¶é›†å˜é‡å­˜å‚¨ å®šä¹‰å˜é‡
int utlDistance;  //è¶…å£°æ³¢è·ç¦» å˜é‡å­˜å‚¨
double waterHigh;//å­˜å‚¨æ°´ä½
int lightIntensity;//å­˜å‚¨å…‰ç…§å¼ºåº¦0~99

//ä¸‰ä¸ªååº”æ¨¡å— å¼•è„šå®šä¹‰
//int ledPinUlt = D3; //è¶…å£°æ³¢è·ç¦»é¢„è­¦ç¯å…‰ ä¿ç•™éœ‡åŠ¨ç”¨
//int ledPinWater = D4;  //æ°´ä½è¿‡é«˜éœ‡åŠ¨ç”¨
int ledPinLight = D3;  //å…‰ç…§è¿‡ä½ ç¯å…‰ç‚¹äº®æé†’è·¯äºº

int LED = D6;  //ç”¨äºè¿œç¨‹æ“æ§ç¯å…‰  æ•ˆåº”å™¨

long lastMsg = 0; //å®šæ—¶å™¨æ ‡å¤´

int KEY=D5;//KEYå¯¹åº”D5 
char flag=1;


////////////////////////setupå‡½æ•°/////////////////////////////////////
void setup() {
// ç”¨äºä¸²å£é€šä¿¡é€Ÿç‡è®¾ç½®
    Serial.begin(115200);

//ç”¨äºå¼•è„šæ¨¡å¼è®¾ç½®
//    //è¿œç¨‹æ§åˆ¶çš„ç¯å…‰ è®¾ç½®ä¸ºè¾“å‡ºæ¨¡å¼
//    pinMode(LED, OUTPUT);  
//
//    //æœ¬åœ°éœ‡åŠ¨1 è¶…å£°æ³¢è¿‡è¿‘éœ‡åŠ¨ è®¾ç½®ä¸ºè¾“å‡ºæ¨¡å¼
//    pinMode(ledPinUlt, OUTPUT);  
//
//    //æœ¬åœ°éœ‡åŠ¨2 æ°´ä½è¿‡é«˜éœ‡åŠ¨ è®¾ç½®ä¸ºè¾“å‡ºæ¨¡å¼
//    pinMode(ledPinWater, OUTPUT);  

    //æœ¬åœ°å…‰ç…§3 å…‰ç…§è¿‡ä½ ç‚¹äº® è®¾ç½®ä¸ºè¾“å‡ºæ¨¡å¼
    pinMode(ledPinLight,OUTPUT);
  
//    //è¶…å£°æ³¢ä¼ æ„Ÿå™¨ ä¸¤ä¸ªå¼•è„šå®šä¹‰ ä¸€ä¸ªè¾“å…¥ ä¸€ä¸ªè¾“å‡º
//    pinMode(ECHOPin, INPUT); // Sets the echoPin as an Input
//    pinMode(TRIGPin, OUTPUT);// Sets the trigPin as an Output

    //å‘é€é‚®ä»¶çš„æŒ‰é”®
    pinMode(KEY,INPUT_PULLUP);//å°†GPIO14 D5 æŒ‰é”®è®¾ç½®ä¸ºä¸Šæ‹‰è¾“å…¥æ¨¡å¼
  
//ç”¨äºè¿æ¥wifi
    WiFi.begin(ssid, password);
    while (WiFi.status() != WL_CONNECTED) {
        delay(500);
        Serial.println("Connecting to WiFi..");
    }
    Serial.println("Connected to the WiFi network");
	  Serial.println("IP åœ°å€: ");
    Serial.println(WiFi.localIP());
  
  
//ç”¨äºè¿æ¥mqttæœåŠ¡ä»£ç†å•†
    client.setServer(mqtt_broker, mqtt_port);
    client.setCallback(callback);
    while (!client.connected()) {
        //ç”¨macåœ°å€åŒºåˆ†å”¯ä¸€ip
        String client_id = "esp8266-client-";
        client_id += String(WiFi.macAddress());
        //è¾“å‡ºå”¯ä¸€macæœåŠ¡åœ°å€
        Serial.println("--------Start - connects states ----------");
        Serial.printf("The client %s connects to the public mqtt broker\n", client_id.c_str());
        if (client.connect(client_id.c_str(), mqtt_username, mqtt_password)) {
            Serial.println("Public emqx mqtt broker connected");
        } else {
            Serial.print("failed with state ");
            Serial.print(client.state());
            delay(2000);
        }
        Serial.println("--------End - connects states ----------");
    }
  
  
//MQTTæ°¸ä¹…è®¢é˜…ä»¥åŠé¦–ä¸ªå‘å¸ƒæµ‹è¯•
    //é¦–ä¸ªå‘å¸ƒæµ‹è¯•
    client.publish(topic2, "the first publish test");
    //è®¢é˜…ä¸»é¢˜
    client.subscribe(topic1);

    client.publish(topic2,"1"); //å‘å¸ƒâ€œ1â€ å ä½
}//setup end


////////////////////////loopå‡½æ•°/////////////////////////////////////
void loop() {

//MQTTé‡è¿æœºåˆ¶
//  if (!client.connected()) {
//    reconnect();
//  }

//MQTTä¸æ–­ç›‘å¬ä¿¡æ¯ ç”¨äºä¿æŒè®¢é˜…çŠ¶æ€
    client.loop();

//æ¯éš”ä¸¤ç§’è°ƒç”¨ä¸€æ¬¡è¶…å£°æ³¢å‡½æ•° åœ¨å†…éƒ¨è°ƒç”¨å‘å¸ƒå‡½æ•°
    long now = millis();
    if (now - lastMsg > 2000) {//å»¶æ—¶2s
       lastMsg = now;
       push_Ultrasound_Water();
       KEY_PROS();//æŒ‰é”®2Sä¸ºä¸€ä¸ªæ£€æµ‹å‘¨æœŸ åˆšå¥½
}
    


}


////////////////////////è‡ªå®šä¹‰å‡½æ•°/////////////////////////////////////

//ç”¨äºæ¥æ”¶æ¶ˆæ¯
void callback(char *topic1, byte *payload, unsigned int length) {
    Serial.println("--------Start - Message arrived ----------");
    Serial.print("Message arrived in topic: ");
    Serial.println(topic1);
    String message;
    for (int i = 0; i < length; i++) {
        //payload åœ¨å‚æ•°é‡Œçš„ç±»å‹æ˜¯ byte*
        message = message + (char) payload[i];  // convert *byte to string
    }
    Serial.print("Message:"); 
    Serial.println(message); //éœ€è¦è¯­éŸ³æ’­æŠ¥å‡ºæ¥
//    if (message == "on") { digitalWrite(LED, HIGH); Serial.println("LEDå·²ç»æ‰“å¼€"); }   // LED on
//    if (message == "off"){ digitalWrite(LED, LOW); Serial.println("LEDå·²ç»å…³é—­"); } // LED off
    Serial.println();
    Serial.println("--------End - Message arrived ----------");
}


//ç”¨äºå‘é€è¶…å£°æ³¢æµ‹åˆ°çš„æ•°æ®å¹¶åœ¨è¶…å£°æ³¢æµ‹è·è¿‡è¿‘æé†’
void push_Ultrasound_Water() {
  

//å…‰ç…§æ£€æµ‹  åªæœ¬åœ°
    Serial.println("--------Start - Light - detect----------");
    Serial.print("å…‰ç…§å¼ºåº¦ï¼š "); 
    lightIntensity = shine();
    Serial.println(lightIntensity);  //ä¸²å£ç›‘è§†å™¨æ˜¾ç¤ºå…‰ç…§å¼ºåº¦
    Serial.print("\n");  //å›è½¦
    if(lightIntensity < 60){
      digitalWrite(ledPinLight,HIGH);//å½“å…‰ç…§å¼ºåº¦å°äº30ï¼Œç‚¹äº®LED D3å¼•è„š
    }
    else{
      digitalWrite(ledPinLight,LOW);
    }
    Serial.println("--------End - Light - detect----------");
    

    
////è¶…å£°æ³¢å’Œæ°´ä½ä»¥â€œ10ï¼Œ10.00â€å½¢å¼ä¸€èµ·å‘å¸ƒ,è‹±æ–‡é€—å·åˆ†å‰²å½¢æˆå®Œæ•´å­—ç¬¦ä¸²å‘å¸ƒ
//    Serial.println("--------Start - Ultrasound&&Water - publish - ----------");
//    char text[20]; //é•¿åº¦20çš„å­—ç¬¦ä¸²ï¼Œè¿˜å¯ä»¥char *Buff ;
//    sprintf(text, "%d%s%lf", utlDistance, "  ,  " , waterHigh); 
//    client.publish(topic,text);
//    Serial.printf("Have published %s to the topic of cc36e70148924ef2bb2e1d477c24675f", text); 
//    Serial.println("--------End - Ultrasound&&Water - publish----------");
}


//å…‰ç…§å¼ºåº¦æ˜ å°„å‡½æ•°
int shine(){
  int i=analogRead(A0);//å…‰æ„Ÿæ¨¡æ‹Ÿå£æ¥esp8266AOå£
  i=1023-i;
  i=i/10.23-1;   //å°†å…‰ç…§å¼ºåº¦è®¾ç½®ä¸º0-99
  return i;
}


//æŒ‰é”®å¤„ç†å‡½æ•°
void KEY_PROS()
{
  if(digitalRead(KEY)==0){
    delay(5);
    if(digitalRead(KEY)==0){ //å¦‚æœæ¥åœ°äº†
      client.publish(topic2,"1"); //å‘å¸ƒâ€œ1â€ å ä½
      Serial.println("å·²ç»å‘é€1åˆ°buttonä¸»é¢˜.");
    }
  }
  
  else if(digitalRead(KEY)==1){//KEYæ¥åœ°ä¸º0 ä¸æ¥åœ°ä¸º1
  
  }
  
//  switch (temp){
//    case 1:alarm();break; //æ’å…¥æ¥åœ° ç‚¹äº® å‘é€é‚®ä»¶
//    case 0: ;break; //å†æ’å…¥æ¥åœ° å†æŒ‰ä¸€ä¸‹ æ¨¡æ‹Ÿæ˜¾ç¤ºç«¯åé¦ˆå å†æŒ‰ä¸€ä¸‹å†å‘é€ä»£è¡¨è¯¯è§¦çš„é‚®ä»¶
//  }
  
}


 

```


## å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹
- çª—å£ä¸èƒ½æœ€å°åŒ– å¦åˆ™æŠ“åˆ°ç­‰å¤§å°çš„æœ€ä¸Šé¢çš„çª—å£ç”»é¢
- å¥æŸ„è¦å…ˆæ£€æµ‹ä¹‹åå¡«å……æ›´æ¢ hwndçš„å€¼
- ç¡¬ä»¶ç¨‹åºçš„æŒ‰é’®æ£€æµ‹ä¸è¦ç›´æ¥æ”¾åœ¨loopé‡Œé¢ æ”¾åœ¨2sä¸€ä¸‹é‡Œé¢ï¼Œå…¶ä¸­æˆ‘ç¬¬ä¸€ä¸ªæ¿å­çš„å‘é‚®ä»¶å¾—ç›Šäºè¿æ¥é‚®ä»¶æœåŠ¡æ¯”è¾ƒæ…¢ å¥½åƒæ˜¯æ”¾åœ¨loopä¹Ÿæ²¡äº‹ ç­‰ç€æœ‰ç©ºè¯•è¯•æ”¹åœ¨2sä¸€ä¸‹çš„æ£€æµ‹é‡Œé¢æµ‹è¯•ä¸€ä¸‹

## å¾…è§£å†³ å¾…ä¼˜åŒ– #å¾…åŠ 
å¾…è§£å†³ï¼šå°†ç¡¬ä»¶æ¥æ”¶åˆ°çš„å­—ç¬¦ä¸²çš„messageè¿›è¡Œè¯­éŸ³æ’­æŠ¥
å¥½åƒè¯­éŸ³åªèƒ½æ’­æŠ¥å·²ç»å­˜å¥½çš„MP3æ–‡ä»¶ é‚£è¿™æ ·æˆ‘å¯ä»¥å­˜è¿™æ ·å‡ ç§ä¸œè¥¿
'å‰æ–¹æœ‰' + '0 1 2 3 4 5' +'ä¸ªäºº/è¾†æ±½è½¦/...' åˆ¤æ–­ç»„åˆè¿›è¡Œæ’­æ”¾ï¼Ÿ

å¾…ä¼˜åŒ–ï¼šå°†ipcamçš„å¸§ç›´æ¥åœ¨pythonæŠ“å– è€Œä¸æ˜¯æŠ“å–çª—å£çš„æ˜¾ç¤ºç”»é¢

# YOLOå‡½æ•°è°ƒç”¨
## osåº“é‡Œé¢çš„popen()æ–¹æ³•è°ƒç”¨ - è¯»å–è¯†åˆ«ä¿¡æ¯ æ’­æŠ¥ #å¾…åŠ


å‚è€ƒè°ƒç”¨ï¼š[YOLOv5åœ¨Djangoä¸­è°ƒç”¨_ä¸€ä¸ªåˆå­¦è€…^^çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/x1114331429/article/details/122743811)


[python-os-popen-æ–¹æ³•](0101%20æ¯•è®¾ä»“åº“/python-os-popen-æ–¹æ³•.md)
![](201903040009images.aasts/image-20230409214708196.png)

![](201903040009images.aasts/image-20230409215257088.png)







[Pythonä¸­osåº“é‡Œé¢çš„popen()æ–¹æ³•_res = os.popen('curl -s cip.cc --connect-timeout 1_é²²é¹é£ä¹ä¸‡é‡Œçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/hefrankeleyn/article/details/85098186#:~:text=%E6%A6%82%E8%BF%B0%20os.%20popen%20%28%29%20%E6%96%B9%E6%B3%95%20%E7%94%A8%E4%BA%8E%E4%BB%8E%E4%B8%80%E4%B8%AA%E5%91%BD%E4%BB%A4%E6%89%93%E5%BC%80%E4%B8%80%E4%B8%AA%E7%AE%A1%E9%81%93%E3%80%82%20%E5%9C%A8Unix%EF%BC%8CWindows%20%E4%B8%AD,%E4%BD%BF%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4%E3%80%82%20mode%20%E2%80%93%20%E6%A8%A1%E5%BC%8F%E6%9D%83%E9%99%90%E5%8F%AF%E4%BB%A5%E6%98%AF%20%E2%80%98r%E2%80%99%20%28%E9%BB%98%E8%AE%A4%29%20%E6%88%96%20%E2%80%98w%E2%80%99%E3%80%82)



## å¯ä»¥æ”¾åœ¨viewå‡½æ•°ä»£ç æ®µå‚è€ƒ
å‡ ä¸ªéœ€è¦è§£å†³çš„é—®é¢˜ï¼š
- OSåº“Â popen() æ–¹æ³•çš„ä½¿ç”¨
- cmdå‘½ä»¤çš„æ›¿æ¢
- å‡½æ•°è°ƒç”¨æ–¹å¼ ä¸åŒpythonå‡½æ•°å¦‚ä½•è°ƒç”¨
- åªæ˜¯æ‰“å°å‡ºæ¥äº†ä¸€èˆ¬æƒ…å†µçš„ï¼ˆå¦‚å›¾ç‰‡çš„ï¼‰ä¿¡æ¯ å¦‚æœæˆ‘æ¢æˆè¯†åˆ«è§†é¢‘çš„å‘½ä»¤ è§†é¢‘å»å“ªäº†
```
def getperson(url:str) -> int:
	'''
	å¤„ç†å›¾ç‰‡
	:param url:å›¾ç‰‡åœ°å€
	:return: å›¾ç‰‡ä¸­çš„äººæ•°
	'''
	cmd = r'python D:\pyproject\yolov5-django\detect.py --source ' + url + ' --classes 0 --exist-ok'
	text = os.popen(cmd).readlines()
	print(text)
	person = re.findall('.* (.*?) person', str(text))
	if len(person) == 0:
		print('å›¾åƒå†…æ²¡æœ‰äºº')
		return int(0)
	else:
		print('ä¸€å…±æœ‰',person[0],'äºº') # æ‰“å°äººæ•°
		return int(person[0])

if __name__ == '__main__':
    getperson()
```

### é—®é¢˜1 popenæ–¹æ³•
å¼•å…¥åº“ä»¥åŠç®€å•çš„è®¤è¯†ï¼š
[Python os.popen() æ–¹æ³• | èœé¸Ÿæ•™ç¨‹ (runoob.com)](https://www.runoob.com/python/os-popen.html)




---

`è¿è¡Œè¿‡ç¨‹é‡åˆ°çš„ä¸€äº›é—®é¢˜`

---

VS Code Python â€œStatements must be separated by newlines or semicolonsâ€œ
![](201903040009images.aasts/image-20230409185450961.png)

![](201903040009images.aasts/image-20230409185527296.png)

åŠ æ‹¬å·å°±è¡Œäº† python3ä¸åŠ ä¸è¡Œ

---
![](201903040009images.aasts/image-20230409213529896.png)


---


### é—®é¢˜2 è°ƒç”¨æ ¼å¼
cmdæ ¼å¼ï¼šï¼ˆé¡¹ç›®ä¸‹æ‰§è¡Œå¯ä»¥ï¼Œç³»ç»Ÿcmdæ‰§è¡ŒæŠ¥é”™ï¼‰

```
python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --source D:/Desktop/image/bus.jpg  ã€--classes 0 --exist-okã€‘
```

cmdå…ˆåˆ‡æ¢ç›˜ç¬¦ å†è¿ç»­æ‰§è¡Œyoloæµ‹è¯•æ˜¯å¦æ­£ç¡® <span style="background:#ff4d4f"> ç‰›é€¼ æ­£ç¡®äº† ä¸‹é¢å¯ä»¥readlines() è¯•è¯•æœ‰æ²¡æœ‰ç»“æœäº†</span>

```
d: && python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --source D:/Desktop/image/bus.jpg 
```

![](201903040009images.aasts/image-20230409224110804.png)

![](201903040009images.aasts/image-20230409231309186.png)


---


ç›¸å¯¹åœ°å€ æ­£å¸¸æƒ…å†µæ‰§è¡Œçš„å‘½ä»¤ï¼šã€ ç”¨5sä¸€èˆ¬æ¨¡å¤æ‚åº¦å‹ä¸ºä¾‹ã€‘
python detect.py --weights yolov5s.pt --source data/images/bus.jpg

å‚è€ƒåœ°å€ å¾…ä¿®æ”¹ï¼š
```
cmd = r'python D:\pyproject\yolov5-django\detect.py --source ' + url + ' --classes 0 --exist-ok'
```


yoloä¸»å‡½æ•°åœ°å€ï¼š
```
D:\Desktop\yolov5-7.0
```


è‡ªå®šä¹‰æˆ‘çš„åœ°å€ï¼š
urlè‡ªå¡«å……
```
cmd = r'python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --source ' + url + ' --classes 0 --exist-ok'
```

ä»¥æ¡Œé¢ä¸€ä¸ªæ–‡ä»¶å¤¹å†…çš„å›¾ç‰‡ä¸ºä¾‹

```
D:\Desktop\image\photo.jpg
```

![](201903040009images.aasts/image-20230409190451742.png)


### ä»£ç æµ‹è¯•å­˜æ¡£


```
#!/usr/bin/python
# -*- coding: UTF-8 -*-

import os, sys, re

# yolo è°ƒç”¨
def getperson(url:str) -> int:
	'''
	å¤„ç†å›¾ç‰‡
	:param url:å›¾ç‰‡åœ°å€
	:return: å›¾ç‰‡ä¸­çš„äººæ•°
	'''
	cmd = r'python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --source ' + url + ' --classes 0 --exist-ok'
	#ä¸‹é¢è¿™è¡Œä¸å¤ªå¯¹ ä¸èƒ½è¯»å–å†™å†…å­˜ åœ¨readä¹‹å‰çš„é‚£ä¸ªä¸œè¥¿ 
	text = os.popen(cmd).readlines()
	print('********************')
	print(text)
	print("********************")
	person = re.findall('.* (.*?) person', str(text))
	if len(person) == 0:
		print('å›¾åƒå†…æ²¡æœ‰äºº')
		return int(0)
	else:
		print('ä¸€å…±æœ‰',person[0],'äºº') # æ‰“å°äººæ•°
		return int(person[0])

if __name__ == '__main__':
    getperson("D:/Desktop/image/bus.jpg")
```


```
#!/usr/bin/python
# -*- coding: UTF-8 -*-

import os, sys, re

# yolo è°ƒç”¨
def getperson(url:str) -> int:
	'''
	å¤„ç†å›¾ç‰‡
	:param url:å›¾ç‰‡åœ°å€
	:return: å›¾ç‰‡ä¸­çš„äººæ•°
	'''
	cmd = r'python D:\Desktop\yolov5-7.0\detect.py --weights yolov5s.pt --source ' + url + ' --classes 0 --exist-ok'
	#ä¸‹é¢è¿™è¡Œèƒ½è¯»å–å†™å†…å­˜ åœ¨readä¹‹å‰çš„é‚£ä¸ªä¸œè¥¿ 
	text = os.popen(cmd,"r",50)
	print('********************')
	print(text)
	print("********************")
	person = re.findall('.* (.*?) person', str(text))
	if len(person) == 0:
		print('å›¾åƒå†…æ²¡æœ‰äºº')
		return int(0)
	else:
		print('ä¸€å…±æœ‰',person[0],'äºº') # æ‰“å°äººæ•°
		return int(person[0])

if __name__ == '__main__':
    getperson("D:/Desktop/image/bus.jpg")
```

## æ€è·¯2 åœ¨yoloæœ¬èº«ä¸‹åŠŸå¤« ä¿å­˜åœ¨txtä¹‹ç±» #å¾…åŠ

[pythonæ ¹æ®yolov5æ£€æµ‹å¾—åˆ°çš„txtæ–‡ä»¶ï¼Œæˆªå–ç›®æ ‡æ¡†å›¾ç‰‡å¹¶ä¿å­˜_yolov5 ç›®æ ‡æˆªå›¾_æ·±åº¦å­¦ä¹ èœé¸Ÿçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/qq_36756866/article/details/116762837)

[YOLOv3è§†é¢‘æ£€æµ‹åŠæ£€æµ‹ç»“æœä¿å­˜ï¼ˆå‚»ç“œå¼ï¼Œä¸æ”¹ä»£ç ï¼Œé€‚ç”¨äºå°†YOLOv3åšé»‘ç›’ä½¿ç”¨çš„åŒå­¦ï¼‰_å²³éº“å¹é›ªçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/lin453701006/article/details/101349398)






# å‰ç«¯æ˜¾ç¤ºè¯†åˆ«ç”»é¢
## æ–¹æ¡ˆ1 htmlç›´æ¥å†™pythonä»£ç  
[ä»€ä¹ˆï¼Ÿå¯ä»¥åœ¨ HTML ä¸­ç›´æ¥æ’å…¥ Python ä»£ç ï¼Ÿ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/510792410)


## æ–¹æ¡ˆ2 htmlè°ƒç”¨cmdå‘½ä»¤ - ä»…ie å¼¹çª—
[htmlç½‘é¡µè°ƒç”¨cmdå‘½ä»¤è¡Œå¹¶æ‰§è¡Œå‘½ä»¤ï¼ˆäº²æµ‹å¯ç”¨ï¼‰_htmlæ‰§è¡Œcmdå‘½ä»¤_ç‹å»¶å‡¯çš„åšå®¢çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/weixin_38468077/article/details/120508802)


```html
 
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
    <title>æµ‹è¯•php+jsè°ƒç”¨cmdå‘½ä»¤è¡Œ</title>
    </head>
     
     
    <body>
     <a href="#" onclick="win_run(); return false;">è°ƒç”¨cmd</a>
    </body>
     
    <script type="text/javascript">
    function win_run(){	
    var cmd=new ActiveXObject("WScript.Shell");
    cmd.run("cmd.exe /k d: && python D:/Desktop/yolov5-7.0/detect.py --weights yolov5s.pt --source http://admin:admin@192.168.127.245:8081 && activate py35 && python pr.py > result.txt");//ç™¾åº¦æœç´¢cmdå¤šå‘½ä»¤è¡Œä¸€èµ·å†™
    cmd=null;
     window.setTimeout('window.close();',3000);
    }
    </script>
    </html>
    
```

## æ–¹æ¡ˆ3 TensorFlow.js è°ƒç”¨yolo  ğŸ‘
[ç®€å•ä½¿ç”¨TensorFlow.jsåœ¨æµè§ˆå™¨è¿›è¡Œè§†é¢‘å®æ—¶ç›®æ ‡è¯†åˆ«(åŸºäºYOLO V3) - iNick - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/inick/p/13804411.html)

![](201903040009images.aasts/image-20230410152304662.png)

## æ–¹æ¡ˆ3 è‡ªå·±çš„å®ç°æƒ³æ³•
ç»ˆç«¯æŒ‰ä¸€ä¸ªæŒ‰é’® å‘å¸ƒä¸€æ¡å‘½ä»¤ viewå‡½æ•°æŠ“å–å½“å‰å±å¹•ï¼Œæˆªå›¾ä¹‹ç±»ï¼ˆå½“å‰æ¡Œé¢è¿è¡Œç€ipcamçš„æ— è¯†åˆ«çš„ç”»é¢ æ’­æ”¾ï¼‰ï¼Œæ–‡ä»¶è¯»å– å­˜åœ¨æŸä¸ªæ–‡ä»¶å¤¹å†…

å†è°ƒç”¨popen()æ–¹æ³• cmd è¯†åˆ« å°†è¯†åˆ«å‡ºæ¥çš„ä¿¡æ¯ å­˜åœ¨å­—ç¬¦ä¸²ä¸­ å¹¶å‘å¸ƒå‡ºå»  ç»ˆç«¯è¯­éŸ³æ’­æŠ¥

### yolo cmdä¸ºç©º æœªè§£å†³ğŸ˜¥
ç›®å‰æœªé€šçš„ä¸€äº›ç‚¹ï¼šcmd è¯†åˆ« å°†è¯†åˆ«å‡ºæ¥çš„ä¿¡æ¯ æ— æ³•æ­£å¸¸è¯†åˆ« æ‰“å°ä¸ºç©º å…¶ä»–cmdå‘½ä»¤æ­£å¸¸  yoloä¸ºç©º
[Pythonè·å–CMDå‘½ä»¤è¡Œè¾“å‡ºç»“æœ - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/117495961)


### pythonæŠ“å± 
éœ€è¦æ”¹å–„çš„ä¸€ä¸ªç‚¹ï¼šæŠ“å–å½“å‰å±å¹•ï¼Œæˆªå›¾ä¹‹ç±» èƒ½ä¸èƒ½ç›´æ¥æŠ“åå° ä¸ä¸€å®šéå¾—æˆªå±å½“å‰ã€å¯¹è§†é¢‘å¸§çš„æŠ“å–å¹¶ä¿å­˜ã€‘â€˜=

### pyQTæŒ‡å®šçª—å£æˆªå›¾  ğŸ‘ä¸»æ¨è·¯çº¿

---


 `Python ä¸‰ç§æ–¹æ³•å®ç°æˆªå›¾ã€è¯¦è§£+å®Œæ•´ä»£ç ã€‘` 
 ç¬¬äºŒç§ PyQt å¯ä»¥æŠ“å– æŒ‡å®šè·å–çš„çª—å£ï¼Œå³ä½¿çª—å£è¢«é®æŒ¡ã€‚
 `å‚è€ƒ1`
[(1æ¡æ¶ˆæ¯) Python ä¸‰ç§æ–¹æ³•å®ç°æˆªå›¾ã€è¯¦è§£+å®Œæ•´ä»£ç ã€‘_pythonæˆªå›¾_èš‚èšçˆ±Pythonçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/xff123456_/article/details/128501167?spm=1001.2101.3001.6650.5&utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-5-128501167-blog-125820193.235%5Ev28%5Epc_relevant_t0_download&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7ERate-5-128501167-blog-125820193.235%5Ev28%5Epc_relevant_t0_download&utm_relevant_index=10)  


åˆå§‹ä»£ç  å…¨æ˜¯ ä¹±ä¹±çš„ ç‰¹ç‚¹ ä¼šæ‰“å°å½“å‰æ‰€æœ‰çš„çª—å£ID ç„¶åå›¾ç‰‡æ˜¯

```
# å…ˆå¼•å…¥ä¾èµ–åŒ… pip install PyQt5
import win32gui
from PyQt5.QtWidgets import QApplication
import sys
 
hwnd_title = dict()
 
 
def get_all_hwnd(hwnd, mouse):
    if win32gui.IsWindow(hwnd) and win32gui.IsWindowEnabled(hwnd) and win32gui.IsWindowVisible(hwnd):
        hwnd_title.update({hwnd: win32gui.GetWindowText(hwnd)})

 
win32gui.EnumWindows(get_all_hwnd, 0)
# print(hwnd_title.items()) æ‰“å°çš„æ˜¯hwndå€¼å’Œå¯¹åº”çš„Title
for h, t in hwnd_title.items():
    if t != "":
        print(h, t)
 
# ç¨‹åºä¼šæ‰“å°çª—å£çš„hwnd[æ£€ç´¢çª—å£å¥æŸ„]å’Œtitleï¼Œæœ‰äº†titleå°±å¯ä»¥è¿›è¡Œæˆªå›¾äº†ã€‚ exeæ–‡ä»¶spy++è·å–classå’ŒTitle å…¶å®ä¸Šé¢æ‰“å°å¯¹åº”çš„hwndäº† è¿™ä¸ªå¯ä»¥çœç•¥
FrameClass = "OrpheusBrowserHost"
FrameTitle = "Catch My Breath - Kelly Clarkson"
hwnd = win32gui.FindWindow(FrameClass, FrameTitle)
print(hwnd)
app = QApplication(sys.argv)
screen = QApplication.primaryScreen()
img = screen.grabWindow(hwnd).toImage()
img.save("screenshot.jpg")

 
```


æˆ‘æ”¹å¥½çš„ç¨‹åº 
ä¸€äº›å¤‡æ³¨ï¼š

```
# å…ˆå¼•å…¥ä¾èµ–åŒ… pip install PyQt5
import win32gui
import win32con
from PyQt5.QtWidgets import QApplication
from PIL import ImageGrab

hwnd_title = dict()
 
 # è¿™ä¸€æ®µå’Œä¸‹ä¸€æ®µä¸ºäº†æ‰“å°æ‰€æœ‰çš„titleå¯¹åº”çš„hwndçš„ åªæœ‰ç¬¬ä¸€æ¬¡ç”¨å¾—åˆ° æŠŠhwndå¡«å…¥èµ‹å€¼å³å¯
def get_all_hwnd(hwnd, mouse):
    if win32gui.IsWindow(hwnd) and win32gui.IsWindowEnabled(hwnd) and win32gui.IsWindowVisible(hwnd):
        hwnd_title.update({hwnd: win32gui.GetWindowText(hwnd)})

 
win32gui.EnumWindows(get_all_hwnd, 0)
# print(hwnd_title.items()) æ‰“å°çš„æ˜¯hwndå€¼å’Œå¯¹åº”çš„Title
for h, t in hwnd_title.items():
    if t != "":
        print(h, t)
 
# ç¨‹åºä¼šæ‰“å°çª—å£çš„hwnd[æ£€ç´¢çª—å£å¥æŸ„]å’Œtitleï¼Œæœ‰äº†titleå°±å¯ä»¥è¿›è¡Œæˆªå›¾äº†ã€‚ spy++è·å–classå’ŒTitle å…¶å®ä¸Šé¢æ‰“å°å¯¹åº”çš„hwndäº† è¿™ä¸ªå¯ä»¥çœç•¥
FrameClass = "OrpheusBrowserHost"
FrameTitle = "Catch My Breath - Kelly Clarkson"
hwnd = win32gui.FindWindow(FrameClass, FrameTitle)
print(hwnd)

# hwnd = win32gui.FindWindow(None, 'C:\Windows\system32\cmd.exe')
win32gui.ShowWindow(hwnd, win32con.SW_RESTORE)  # å¼ºè¡Œæ˜¾ç¤ºç•Œé¢åæ‰å¥½æˆªå›¾
win32gui.SetForegroundWindow(hwnd)  # å°†çª—å£æåˆ°æœ€å‰
#  è£å‰ªå¾—åˆ°å…¨å›¾
game_rect = win32gui.GetWindowRect(hwnd)
src_image = ImageGrab.grab(game_rect)
# src_image = ImageGrab.grab((game_rect[0] + 9, game_rect[1] + 190, game_rect[2] - 9, game_rect[1] + 190 + 450))
src_image.show()
src_image.save("screenshot.jpg")
```

`æˆ‘æ”¹å¥½çš„ ä¸ç”¨é¢å¤–è½¯ä»¶çš„å®ç°æ–¹å¼1 åˆšå¼€å§‹å¯¹åº”çš„çª—å£ä¸èƒ½æœ€å°åŒ– æœ€å¥½æ˜¯æ˜¾ç¤ºåœ¨æ¡Œé¢æœ€ä¸Šæ–¹`
æˆ‘æµ‹è¯•å‘ç°ipcamçš„æœ€å¼€å§‹æ”¾åœ¨æœ€ä¸Šé¢æ˜¯å¯ä»¥çš„ 
ç½‘æ˜“äº‘ç­‰å…¶ä»–çš„åº”è¯¥æ˜¯åªè¦ä¸æ˜¯æœ€å°åŒ– è¿˜åœ¨æ¡Œé¢çš„æŸä¸ªå±‚çº§éƒ½æ˜¯å¯ä»¥çš„
æ— è®ºå¦‚ä½• éƒ½ä¸èƒ½æœ€å°åŒ–æ‰ å¦åˆ™åªæœ‰å¯¹åº”çª—å£å¤§å°çš„æœ€ä¸Šä¸€å±‚çš„å›¾åƒæƒ…å†µ

```
# å…ˆå¼•å…¥ä¾èµ–åŒ… pip install PyQt5
import win32gui
import win32con
from PyQt5.QtWidgets import QApplication
from PIL import ImageGrab

hwnd_title = dict()
 
 
def get_all_hwnd(hwnd, mouse):
    if win32gui.IsWindow(hwnd) and win32gui.IsWindowEnabled(hwnd) and win32gui.IsWindowVisible(hwnd):
        hwnd_title.update({hwnd: win32gui.GetWindowText(hwnd)})

 
win32gui.EnumWindows(get_all_hwnd, 0)
# print(hwnd_title.items()) æ‰“å°çš„æ˜¯hwndå€¼å’Œå¯¹åº”çš„Title
for h, t in hwnd_title.items():
    if t != "":
        print(h, t)
 
# ç¨‹åºä¼šæ‰“å°çª—å£çš„hwnd[æ£€ç´¢çª—å£å¥æŸ„]å’Œtitleï¼Œæœ‰äº†hwndå¡«å…¥ä¸‹é¢çš„å˜é‡å°±å¯ä»¥è¿›è¡Œæˆªå›¾äº†
hwnd = 463470 #ä¸Šé¢è·å–åè‡ªå·±å¡«å…¥å¯¹åº”çª—å£çš„hwnd ç¬¬ä¸€åˆ—
print(hwnd)

win32gui.ShowWindow(hwnd, win32con.SW_RESTORE)  # å¼ºè¡Œæ˜¾ç¤ºç•Œé¢åæ‰å¥½æˆªå›¾
win32gui.SetForegroundWindow(hwnd)  # å°†çª—å£æåˆ°æœ€å‰
#  è£å‰ªå¾—åˆ°å…¨å›¾
game_rect = win32gui.GetWindowRect(hwnd)
src_image = ImageGrab.grab(game_rect)
src_image.show()
src_image.save("screenshot.jpg")
```


`æˆ‘æ”¹å¥½çš„ ç”¨é¢å¤–çš„è½¯ä»¶çš„å®ç°æ–¹å¼2`
[(1æ¡æ¶ˆæ¯) pyQTæŒ‡å®šçª—å£æˆªå›¾_chuange6363çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/chuange6363/article/details/100753665)  `å‚è€ƒ2`
[(1æ¡æ¶ˆæ¯) ã€Pythonã€‘win32gui.Findwindow(parm1,parm2)çª—å£å¥æŸ„è·å–_ztmajorçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/ztmajor/article/details/105376319)

éœ€è¦ç”¨åˆ°è½¯ä»¶spy++ è·å–
FrameClass = "OrpheusBrowserHost"
FrameTitle = "Catch My Breath - Kelly Clarkson"
![](201903040009images.aasts/image-20230411221211245.png)

![](201903040009images.aasts/image-20230411221244923.png)

![](201903040009images.aasts/image-20230411221301904.png)

![](201903040009images.aasts/image-20230411221311903.png)


```
# å…ˆå¼•å…¥ä¾èµ–åŒ… pip install PyQt5
import win32gui
import win32con
from PyQt5.QtWidgets import QApplication
from PIL import ImageGrab

hwnd_title = dict()
 
 
def get_all_hwnd(hwnd, mouse):
    if win32gui.IsWindow(hwnd) and win32gui.IsWindowEnabled(hwnd) and win32gui.IsWindowVisible(hwnd):
        hwnd_title.update({hwnd: win32gui.GetWindowText(hwnd)})

 
win32gui.EnumWindows(get_all_hwnd, 0)
# print(hwnd_title.items()) æ‰“å°çš„æ˜¯hwndå€¼å’Œå¯¹åº”çš„Title
for h, t in hwnd_title.items():
    if t != "":
        print(h, t)
 
# clas å’Œ Titleæ˜¯ç»è¿‡spy++ è·å–çš„ å¡«åˆ°ä¸‹é¢
FrameClass = "OrpheusBrowserHost"
FrameTitle = "Catch My Breath - Kelly Clarkson"
hwnd = win32gui.FindWindow(FrameClass, FrameTitle)
print(hwnd)

win32gui.ShowWindow(hwnd, win32con.SW_RESTORE)  # å¼ºè¡Œæ˜¾ç¤ºç•Œé¢åæ‰å¥½æˆªå›¾
win32gui.SetForegroundWindow(hwnd)  # å°†çª—å£æåˆ°æœ€å‰
#  è£å‰ªå¾—åˆ°å…¨å›¾
game_rect = win32gui.GetWindowRect(hwnd)
src_image = ImageGrab.grab(game_rect)
src_image.show()
src_image.save("screenshot.jpg")
```


---
### win32gui.Findwindow(param1,param2)

[(1æ¡æ¶ˆæ¯) ã€Pythonã€‘win32gui.Findwindow(parm1,parm2)çª—å£å¥æŸ„è·å–_ztmajorçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/ztmajor/article/details/105376319)
- param1:éœ€è¦ä¼ å…¥çª—å£çš„ç±»å
- param2:éœ€è¦ä¼ å…¥çª—å£çš„æ ‡é¢˜


---

















# å°è£…è°ƒç”¨ç›¸å…³ /åŸºç¡€çŸ¥è¯†
[yolov5 python APIï¼ˆä¾›å…¶ä»–ç¨‹åºè°ƒç”¨ï¼‰_yolov5 api_æ™®é€šç½‘å‹çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/m0_67401499/article/details/125346054?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-0-125346054-blog-123208715.235^v28^pc_relevant_t0_download&spm=1001.2101.3001.4242.1&utm_relevant_index=3)


## pythonæ–‡ä»¶æ“ä½œ è¯»å†™æ–‡ä»¶
![](201903040009images.aasts/image-20230409220657518.png)


## python å­—ç¬¦ä¸²è½¬æ¢ä¸ºintç±»å‹çš„ä¸¤ç§æ–¹æ³•ï¼ˆé¢è¯•é¢˜ï¼‰
[python å­—ç¬¦ä¸²è½¬æ¢ä¸ºintç±»å‹çš„ä¸¤ç§æ–¹æ³•ï¼ˆé¢è¯•é¢˜ï¼‰_pythonå­—ç¬¦å‹è½¬ä¸ºintå‹_/ä¹¾å¤æœªå®š/çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/qwertyuiopasdfgg/article/details/89307128)







# ä¸€äº›æŠ¥é”™å’Œç»†èŠ‚

## ç©ºæ ¼å’Œtabæ··ç”¨ printä¼šæŠ¥é”™
![](201903040009images.aasts/image-20230409221459274.png)


## éš¾è§£å†³ é‡å¤§é—®é¢˜æ ‡æ³¨ 

![](201903040009images.aasts/image-20230409223912602.png)



![](201903040009images.aasts/image-20230409223808851.png)


![](201903040009images.aasts/image-20230409223753571.png)


## pycharmç´¢å¼•è‡ªåŠ¨æ›´æ–°
---

[Python: PyCharm å¯åŠ¨åæ€»æ˜¯ä¸åœçš„ updating indexes..._pycharm updating indexes_RaySunWHUTçš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/qq_40994260/article/details/113622913)


